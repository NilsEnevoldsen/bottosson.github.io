{
  "version": "https://jsonfeed.org/version/1",
  "title": "Björn Ottosson",
  "home_page_url": "https://bottosson.github.io",
  "feed_url": "https://bottosson.github.io/feed/feed.json",
  "description": "Björn Ottosson&#39;s website",
  "author": {
    "name": "Björn Ottosson",
    "url": ""
  },
  "items": [{
      "id": "https://bottosson.github.io/posts/gamutclipping/",
      "url": "https://bottosson.github.io/posts/gamutclipping/",
      "title": "sRGB gamut clipping",
      "content_html": "<h1 id=\"srgb-gamut-clipping\">sRGB gamut clipping <a class=\"anchor-link\" href=\"#srgb-gamut-clipping\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h1>\n<p>When doing image processing, rendering or converting between RGB color spaces, it is easy to end up with RGB values outside of the 0.0 to 1.0 range (or 0 to 255 for 8-bit colors). This normally means that it isn’t possible to encode the color and it needs to be adjusted somehow before being displayed or encoded (<a href=\"https://en.wikipedia.org/wiki/ScRGB\">scRGB</a> is an example of an exception, and has a different range). The range of supported colors in a color spaces is referred to as a its <em>gamut</em>.</p>\n<p>Many of the colors outside the gamut are still valid colors, they just can’t be encoded in the given color space. The colors that can’t be encoded can be categorized as follows (for RGB color spaces without <a href=\"https://en.wikipedia.org/wiki/Impossible_color#Imaginary_colors\">imaginary primaries</a>):</p>\n<ul>\n<li><strong>One or more RGB values are larger than one, but none are negative</strong><br>\nThese colors are too bright for the color space, but could be encoded at a lower luminance.</li>\n<li><strong>One or more negative values</strong><br>\nThese color are more colorful than the color space is able to encode. Some of these can be real colors, but they can also be colors more colorful than physically possible. This is a consequence of linear encoding of colors, which is able to encode colors that can’t exist in real life.</li>\n</ul>\n<p>The simplest technique for dealing with colors outside the valid range is to simply clamp <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.00773em;\">R</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">G</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">G</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05017em;\">B</span></span></span></span> individually. The simplicity of this makes the technique widespread, but unfortunately it has significant drawbacks and can lead to unpleasant color distortions.</p>\n<p>Here is an example of taking a photo and increasing its exposure and colorfulness significantly, with results displayed as sRGB. Colorfulness has been increased by scaling <a href=\"https://bottosson.github.io/posts/oklab/\">Oklab</a> chroma. RGB values here are simply clamped to the 0.0 to 1.0 range.</p>\n<br/>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/original.jpg\"><img src=\"/img/gamutclipping/flowers/original.jpg\" alt=\"Original\"></a> <em>Unprocessed</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/clipped_rgb.jpg\"><img src=\"/img/gamutclipping/flowers/clipped_rgb.jpg\" alt=\"Processed\"></a> <em>Processed with out of range values clamped</em></p>\n</div>\n</div>\n<br/>\n<p>This is of course problematic. Hues are heavily distorted and all the details in the flowers are gone. Better methods are needed. Thankfully, this problem isn’t new and has been researched a lot over the years.</p>\n<p>Two main research topics exist:</p>\n<blockquote>\n<p><strong><a href=\"https://en.wikipedia.org/wiki/Tone_mapping\">Tone mapping</a></strong>, which is concerned with mapping high dynamic range images to a lower dynamic range. This typically involves altering both colors inside and outside the gamut and sometimes involves different kinds of spatial filtering to keep details while reducing overall dynamic range.</p>\n<p><strong><a href=\"https://en.wikipedia.org/wiki/Color_management#Gamut_mapping\">Gamut mapping</a></strong>, which is concerned with mapping colors from one color space to another and dealing with the mismatch in what colors can be encoded. This can either be done using <em>gamut compression</em> or <em>gamut expansion</em>, which adjusts all colors of an image, or using <em>gamut clipping</em>, which leaves colors that exist in both color spaces intact, while mapping colors outside the gamut back in range. For an overview see the paper <a href=\"https://www.researchgate.net/publication/236121201_The_Fundamentals_of_Gamut_Mapping_A_Survey\">“The Fundamentals of Gamut Mapping: A Survey”</a>.</p>\n</blockquote>\n<p>Tone mapping, gamut expansion and gamut compression are all useful techniques, but will not be the focus of this article. Instead we will limit the scope to creating a practical alternative to clipping sRGB values, by looking at gamut clipping in the sRGB color space and on relatively simple, robust and portable algorithms. The source code for the operations shown is also available, at the <a href=\"#source-code\">end of the article</a>.</p>\n<p>The techniques investigated are also, with some additional work, applicable to other color spaces, and some of the building blocks can be for other things, such as gamut compression. Combining gamut clipping with tone mapping can also be useful since some tone mapping techniques may still produce colors outside the target gamut.</p>\n<h2 id=\"gamut-clipping\">Gamut Clipping <a class=\"anchor-link\" href=\"#gamut-clipping\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h2>\n<p>The goal of gamut clipping is to take colors that are outside the target gamut, and map them back to valid colors in a way that avoids perceived distortion and artifacts. In this article we also want to do this in a way that is reasonably efficient and simple to implement. Many techniques require complex iterative algorithms per pixel (or storing the results in 3D lookup tables) – those will not be considered here, but can be useful for many applications.</p>\n<p>Instead we will take this commonly used approach:</p>\n<ul>\n<li>Work in a perceptual color space.</li>\n<li>Keep hue constant, only change lightness and chroma.</li>\n<li>Only project color along straight lines in the perceptual color space.</li>\n</ul>\n<p>For an overview of different approaches, see the paper <a href=\"https://www.researchgate.net/publication/236121201_The_Fundamentals_of_Gamut_Mapping_A_Survey\">The Fundamentals of Gamut Mapping: A Survey</a>.</p>\n<p>As a color space, we will use the <a href=\"https://bottosson.github.io/posts/oklab/\">Oklab</a> perceptual color space, since it models hue, chroma and lightness well while being easy to work with mathematically. In particular, with Oklab, the shape of the gamut of an RGB color space is described by cubic polynomials, which are quite practical to work with compared to the equations you get with other spaces.</p>\n<p>Since we have decided to keep hue constant, it is now possible to plot the problem in two dimensions, using lightness, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span></span>, and chroma, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span></span></span></span>. To better understand the shape of the sRGB gamut, let’s look at of slices of constant hue. These are sampled every 30 degrees:</p>\n<br/>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/0.png\" alt=\"0\"></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/30.png\" alt=\"30\"></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/60.png\" alt=\"60\"></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/90.png\" alt=\"90\"></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/120.png\" alt=\"120\"></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/150.png\" alt=\"150\"></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/180.png\" alt=\"180\"></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/210.png\" alt=\"210\"></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/240.png\" alt=\"240\"></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/270.png\" alt=\"270\"></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/300.png\" alt=\"300\"></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/hueslices/330.png\" alt=\"330\"></p>\n</div>\n</div>\n<br/>\n<p>Our goal is to find a way to map colors outside the gamut, shown in grey in the graphs, back into the gamut using straight lines. This problem can be split into two parts:</p>\n<ol>\n<li>Deciding along which line to project the color onto the gamut</li>\n<li>Finding the intersection between the line and the gamut</li>\n</ol>\n<p>Lets start by tackling part 2.</p>\n<h2 id=\"intersecting-lines-with-the-gamut\">Intersecting lines with the gamut <a class=\"anchor-link\" href=\"#intersecting-lines-with-the-gamut\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h2>\n<p>The math here is quite involved, so this sections just contains an overview of the approach. If that is still too much math, <a href=\"#choosing-which-line-to-project-along\">skip to the next section</a>. For more details, see the source code.</p>\n<p>Expressed mathematically, the problem we want to solve is: Given a color expressed as <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>L</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>1</mn></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(L_1, C_1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span>, and a point <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>L</mi><mn>0</mn></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>0</mn></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(L_0, C_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span></span> that is known to be inside the gamut, we want to find a value <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.61508em;\"></span><span class=\"strut bottom\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">t</span></span></span></span> so that <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>L</mi><mi>t</mi></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mi>t</mi></msub><mo>)</mo><mo>=</mo><mi>t</mi><mo>(</mo><msub><mi>L</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>1</mn></msub><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>−</mo><mi>t</mi><mo>)</mo><mo>(</mo><msub><mi>L</mi><mn>0</mn></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>0</mn></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(L_t, C_t) = t (L_1, C_1) + (1-t) (L_0, C_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">t</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">t</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span><span class=\"mrel\">=</span><span class=\"mord mathit\">t</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span><span class=\"mbin\">+</span><span class=\"mopen\">(</span><span class=\"mord mathrm\">1</span><span class=\"mbin\">−</span><span class=\"mord mathit\">t</span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span></span> is a point on the gamut surface. We will also set <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>C</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">C_0=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span></span></span></span> since the projections we want to make later always pass through the <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span></span> axis.</p>\n<p>Using the definition of Oklab <a href=\"https://bottosson.github.io/posts/oklab/\">here</a>, we get this conversion from <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mi>C</mi><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">LCh^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span> to linear <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>s</mi><mi>R</mi><mi>G</mi><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">sRGB</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">s</span><span class=\"mord mathit\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathit\">G</span><span class=\"mord mathit\" style=\"margin-right:0.05017em;\">B</span></span></span></span>:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><msup><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">2</mn></msub></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>×</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>C</mi><mi>cos</mi><mo>(</mo><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mrow><mi>C</mi><mi>sin</mi><mo>(</mo><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>)</mo></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>l</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>m</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>s</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>r</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>g</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><msub><mrow><mi mathvariant=\"bold\">M</mi></mrow><mrow><mi>X</mi><mi>Y</mi><mi>Z</mi><mi mathvariant=\"normal\">_</mi><mi>t</mi><mi>o</mi><mi mathvariant=\"normal\">_</mi><mi>s</mi><mi>R</mi><mi>G</mi><mi>B</mi></mrow></msub><msup><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">1</mn></msub></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>×</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix} l&#x27; \\\\ m&#x27; \\\\ s&#x27; \\end{pmatrix} = \\mathbf{M_2}^{-1} \\times \\begin{pmatrix} L \\\\ C\\cos(h^{\\circ}) \\\\ C\\sin(h^{\\circ}) \\end{pmatrix},\\qquad \n\\begin{pmatrix} l \\\\ m \\\\ s \\end{pmatrix} = \\begin{pmatrix} {(l&#x27;)}^{3} \\\\ {(m&#x27;)}^{3} \\\\ {(s&#x27;)}^{3} \\end{pmatrix},\\qquad \n\\begin{pmatrix} r \\\\ g \\\\ b \\end{pmatrix} = \\mathbf{M}_{XYZ\\_to\\_sRGB} \\mathbf{M_1}^{-1} \\times \\begin{pmatrix} l \\\\ m \\\\ s \\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.0905em;\"></span><span class=\"strut bottom\" style=\"height:3.681em;vertical-align:-1.5905000000000002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">m</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">s</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"vlist\"><span style=\"top:-0.41300000000000003em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">−</span><span class=\"mord mathrm\">1</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">×</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"mop\">cos</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"mop\">sin</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">m</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">s</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2235em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span><span class=\"vlist\"><span style=\"top:-0.41589200000000004em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">3</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:0.0035000000000005582em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">m</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span><span class=\"vlist\"><span style=\"top:-0.41589200000000004em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">3</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:1.2305000000000001em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">s</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span><span class=\"vlist\"><span style=\"top:-0.41589200000000004em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">3</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.03588em;\">g</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">b</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathbf\">M</span></span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord mathit\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">Z</span><span class=\"mord mathrm\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord mathit\">t</span><span class=\"mord mathit\">o</span><span class=\"mord mathrm\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathit\">G</span><span class=\"mord mathit\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"vlist\"><span style=\"top:-0.41300000000000003em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">−</span><span class=\"mord mathrm\">1</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">×</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">m</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">s</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<p>The gamut is then defined by the following inequalities:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>r</mi><mo>&lt;</mo><mn>1</mn><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><mn>0</mn><mo>&lt;</mo><mi>g</mi><mo>&lt;</mo><mn>1</mn><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><mn>0</mn><mo>&lt;</mo><mi>b</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">0 &lt; r &lt; 1,\\qquad 0 &lt; g &lt; 1,\\qquad 0 &lt; b &lt; 1 \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord mathrm\">0</span><span class=\"mrel\">&lt;</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span><span class=\"mrel\">&lt;</span><span class=\"mord mathrm\">1</span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"mord mathrm\">0</span><span class=\"mrel\">&lt;</span><span class=\"mord mathit\" style=\"margin-right:0.03588em;\">g</span><span class=\"mrel\">&lt;</span><span class=\"mord mathrm\">1</span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"mord mathrm\">0</span><span class=\"mrel\">&lt;</span><span class=\"mord mathit\">b</span><span class=\"mrel\">&lt;</span><span class=\"mord mathrm\">1</span></span></span></span></span></p>\n<p>This is enough information to solve the problem numerically, but involves solving six cubic polynomials. We are after a faster solution that uses more knowledge about the problem.</p>\n<p>By studying the gamut graphs and the equations, we can draw a few conclusions:</p>\n<ul>\n<li>For a given hue, the lower limit is always a straight line passing through <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(0,0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord mathrm\">0</span><span class=\"mpunct\">,</span><span class=\"mord mathrm\">0</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>The gamut shape is always close to a triangle, with two of its corners in <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(1,0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord mathrm\">1</span><span class=\"mpunct\">,</span><span class=\"mord mathrm\">0</span><span class=\"mclose\">)</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(0,0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord mathrm\">0</span><span class=\"mpunct\">,</span><span class=\"mord mathrm\">0</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>If we can find the third point, we know exactly the lower limit and we have good first approximation of the upper limit</li>\n</ul>\n<p>The location of the third point, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">(L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>C</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">C_{cusp})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span></span>, only depends on <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span>. To find it we use a fitted numerical approximation followed by a single step of <a href=\"https://en.wikipedia.org/wiki/Halley%27s_method\">Halley’s method</a>, this gives an error less than <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mn>0</mn><mi>e</mi><mn>6</mn></mrow><annotation encoding=\"application/x-tex\">10e6</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.64444em;\"></span><span class=\"strut bottom\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">0</span><span class=\"mord mathit\">e</span><span class=\"mord mathrm\">6</span></span></span></span> (except for one point where the derivative <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">∂</mi><msub><mi>C</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub><mi mathvariant=\"normal\">/</mi><mi mathvariant=\"normal\">∂</mi><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">\\partial C_{cusp}/\\partial h^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathrm\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathrm\">/</span><span class=\"mord mathrm\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span> is close to infinite). Since this only depends on <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span> it is also possible to use a 1D lookup table for it.</p>\n<p>With the location for the cusp, it is now possible to find the intersection with the triangle. If the intersection is with the lower edge, this is everything we need to do. If the intersection is with the upper half, the triangle is only an approximation and we need to refine the solution. Again, one step of Halley’s method is enough to do this with high accuracy.</p>\n<p>Altogether, this is everything needed to find the intersection between a line and the sRGB gamut. To derive the numerical approximation of the location of the cusp, this <a href=\"https://colab.research.google.com/drive/1JdXHhEyjjEE--19ZPH1bZV_LiGQBndzs?usp=sharing\">Google Colab Notebook</a> was used. With same method is should be possible derive approximations for other RGB color spaces. The complete source code is available at the <a href=\"#source-code\">end of this article</a>.</p>\n<h2 id=\"choosing-which-line-to-project-along\">Choosing which line to project along <a class=\"anchor-link\" href=\"#choosing-which-line-to-project-along\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h2>\n<p>Starting with a point <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>L</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>1</mn></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(L_1, C_1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span></span>, we want to decide a point <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>L</mi><mn>0</mn></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>0</mn></msub><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(L_0, C_0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span></span> within the gamut to project towards. The choice is a matter of preference and can depend on context.</p>\n<p>Let’s start by testing a few simple existing methods and see what the projections look like for different hue slices and when applied the test image from the beginning.</p>\n<h4 id=\"keep-lightness-constant%2C-only-compress-chroma\">Keep lightness constant, only compress chroma <a class=\"anchor-link\" href=\"#keep-lightness-constant%2C-only-compress-chroma\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Lightness is kept constant if it is between zero and one, otherwise it is clamped. This is done by projecting towards <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>L</mi><mn>0</mn></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>0</mn></msub><mo>)</mo><mo>=</mo><mo>(</mo><mi>c</mi><mi>l</mi><mi>a</mi><mi>m</mi><mi>p</mi><mo>(</mo><msub><mi>L</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo>)</mo><mo separator=\"true\">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(L_0, C_0) = (clamp(L_1, 0, 1), 0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span><span class=\"mrel\">=</span><span class=\"mopen\">(</span><span class=\"mord mathit\">c</span><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">m</span><span class=\"mord mathit\">p</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord mathrm\">0</span><span class=\"mpunct\">,</span><span class=\"mord mathrm\">1</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mord mathrm\">0</span><span class=\"mclose\">)</span></span></span></span></p>\n<br/>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/redslices/clipped_chroma.png\" alt=\"30\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>3</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=30^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">3</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/yellowgreenslices/clipped_chroma.png\" alt=\"120\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>1</mn><mn>2</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=120^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column is-half\">\n<p><a href=\"/img/gamutclipping/flowers/clipped_chroma.jpg\"><img src=\"/img/gamutclipping/flowers/clipped_chroma.jpg\" alt=\"flowers\"></a> <em>Gamut clipping test</em></p>\n</div>\n</div>\n<br/>\n<h4 id=\"projection-towards-a-single-point%2C-hue-independent\">Projection towards a single point, hue independent <a class=\"anchor-link\" href=\"#projection-towards-a-single-point%2C-hue-independent\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Colors are projected towards the middle of the valid greyscale colors: <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>L</mi><mn>0</mn></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>0</mn></msub><mo>)</mo><mo>=</mo><mo>(</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mo separator=\"true\">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(L_0, C_0) = (0.5, 0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span><span class=\"mrel\">=</span><span class=\"mopen\">(</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mpunct\">,</span><span class=\"mord mathrm\">0</span><span class=\"mclose\">)</span></span></span></span></p>\n<br/>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/redslices/sp_middle_grey.png\" alt=\"30\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>3</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=30^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">3</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/yellowgreenslices/sp_middle_grey.png\" alt=\"120\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>1</mn><mn>2</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=120^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column is-half\">\n<p><a href=\"/img/gamutclipping/flowers/sp_middle_grey.jpg\"><img src=\"/img/gamutclipping/flowers/sp_middle_grey.jpg\" alt=\"flowers\"></a> <em>Gamut clipping test</em></p>\n</div>\n</div>\n<br/>\n<h4 id=\"projection-towards-a-single-point%2C-hue-dependent\">Projection towards a single point, hue dependent <a class=\"anchor-link\" href=\"#projection-towards-a-single-point%2C-hue-dependent\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Colors are projected towards the lightness of the cusp of the gamut for the current hue: <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>(</mo><msub><mi>L</mi><mn>0</mn></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>0</mn></msub><mo>)</mo><mo>=</mo><mo>(</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub><mo separator=\"true\">,</mo><mn>0</mn><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">(L_0, C_0) = (L_{cusp}, 0)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span><span class=\"mrel\">=</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord mathrm\">0</span><span class=\"mclose\">)</span></span></span></span></p>\n<br/>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/redslices/sp_L_cusp.png\" alt=\"30\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>3</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=30^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">3</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/yellowgreenslices/sp_L_cusp.png\" alt=\"120\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>1</mn><mn>2</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=120^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column is-half\">\n<p><a href=\"/img/gamutclipping/flowers/sp_L_cusp.jpg\"><img src=\"/img/gamutclipping/flowers/sp_L_cusp.jpg\" alt=\"flowers\"></a> <em>Gamut clipping test</em></p>\n</div>\n</div>\n<br/>\n<h4 id=\"can-we-do-better%3F\">Can we do better? <a class=\"anchor-link\" href=\"#can-we-do-better%3F\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>The choice of projection will always be a matter of preference. Overall I think preserving lightness does the best overall of the above methods (and others agree, it is a commonly used technique). One challenge with preserving lightness though is that all colors with <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">L&gt;1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.72243em;vertical-align:-0.0391em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mrel\">&gt;</span><span class=\"mord mathrm\">1</span></span></span></span> or <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L&lt;0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.72243em;vertical-align:-0.0391em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mrel\">&lt;</span><span class=\"mord mathrm\">0</span></span></span></span> get projected to a single point, and that highly saturated colors can become almost completely desaturated if light or dark enough, even though sacrificing just a small amount of lightness would have resulted in a much closer match.</p>\n<p>For this reason I’ve looked into creating new methods that mostly preserve lightness, but behaves closer to the single point projection methods for high and low lightness colors. The result is two new methods. They are novel as far as I am aware, but there are a lot of gamut mapping papers I haven’t read.</p>\n<p>The first methiod is based on projection towards <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mo separator=\"true\">,</mo><mi>C</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L=0.5, C=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mpunct\">,</span><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span></span></span></span> and the second based on <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub><mo separator=\"true\">,</mo><mi>C</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L=L_{cusp}, C=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.969438em;vertical-align:-0.286108em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span></span></span></span>. Both have a parameter <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span></span></span></span> to control to what extent lightness is preserved. <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span></span></span></span> is a real number larger than 0, where values close to zero will behave as pure chroma compression, and larger values will behave closer to the single point projection methods. Here is an overview of the two methods:</p>\n<h4 id=\"adaptive-%2C-hue-independent\">Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">L_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span>, hue independent <a class=\"anchor-link\" href=\"#adaptive-%2C-hue-independent\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>This method blends between pure chroma compression and projection towards a single point, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L_0=0.5, C_0=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.8777699999999999em;vertical-align:-0.19444em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span></span></span></span>.</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">L_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span> is computed with the following equations:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mi>d</mi></msub><mo>=</mo><msub><mi>L</mi><mn>1</mn></msub><mo>−</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">L_d = L_1-0.5 \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">−</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>=</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn><mo>+</mo><mi mathvariant=\"normal\">∣</mi><msub><mi>L</mi><mi>d</mi></msub><mi mathvariant=\"normal\">∣</mi><mo>+</mo><mi>α</mi><msub><mi>C</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">e_1 = 1/2 + |L_d| + \\alpha C_1 \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">e</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">/</span><span class=\"mord mathrm\">2</span><span class=\"mbin\">+</span><span class=\"mord mathrm\">∣</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathrm\">∣</span><span class=\"mbin\">+</span><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mfrac><mrow><mn>1</mn><mo>+</mo><mi>s</mi><mi>g</mi><mi>n</mi><mo>(</mo><msub><mi>L</mi><mi>d</mi></msub><mo>)</mo><mo>(</mo><msub><mi>e</mi><mn>1</mn></msub><mo>−</mo><msqrt><mrow><msubsup><mi>e</mi><mn>1</mn><mn>2</mn></msubsup><mo>−</mo><mn>2</mn><mi mathvariant=\"normal\">∣</mi><msub><mi>L</mi><mi>d</mi></msub><mi mathvariant=\"normal\">∣</mi></mrow></msqrt><mo>)</mo></mrow><mn>2</mn></mfrac><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><msub><mi>C</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L_0 = \\frac{1 + sgn(L_d)(e_1 - \\sqrt{e_1^2 - 2 |L_d|})} 2 ,\\qquad C_0 = 0 \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:1.63001em;\"></span><span class=\"strut bottom\" style=\"height:2.31601em;vertical-align:-0.686em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord reset-textstyle displaystyle textstyle uncramped\"><span class=\"sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist\"><span style=\"top:0.686em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"reset-textstyle textstyle cramped\"><span class=\"mord mathrm\">2</span></span></span><span style=\"top:-0.22999999999999998em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped frac-line\"></span></span><span style=\"top:-0.680205em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped\"><span class=\"mord textstyle uncramped\"><span class=\"mord mathrm\">1</span><span class=\"mbin\">+</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathit\">n</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">e</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">−</span><span class=\"sqrt mord\"><span class=\"sqrt-sign\" style=\"top:-0.05980500000000011em;\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing size1\">√</span></span></span><span class=\"vlist\"><span style=\"top:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"mord textstyle cramped\"><span class=\"mord\"><span class=\"mord mathit\">e</span><span class=\"vlist\"><span style=\"top:0.26630799999999993em;margin-left:0em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span style=\"top:-0.34480000000000005em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">−</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">∣</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathrm\">∣</span></span></span><span style=\"top:-0.869805em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped sqrt-line\"></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span>​</span></span></span><span class=\"sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter\"></span></span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span></span></span></span></span></p>\n<p>Here are some results with different values for <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span></span></span></span>:</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"1.2em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\large \\alpha = 0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.773328em;\"></span><span class=\"strut bottom\" style=\"height:0.773328em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size6 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></p>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/redslices/adaptive_middle_grey_0_05.png\" alt=\"30\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>3</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=30^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">3</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/yellowgreenslices/adaptive_middle_grey_0_05.png\" alt=\"120\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>1</mn><mn>2</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=120^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column is-half\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_middle_grey_0_05.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_middle_grey_0_05.jpg\" alt=\"flowers\"></a> <em>Gamut clipping test</em></p>\n</div>\n</div>\n<p>\\large <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">\\alpha = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.64444em;\"></span><span class=\"strut bottom\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></p>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/redslices/adaptive_middle_grey_0_50.png\" alt=\"30\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>3</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=30^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">3</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/yellowgreenslices/adaptive_middle_grey_0_50.png\" alt=\"120\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>1</mn><mn>2</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=120^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column is-half\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_middle_grey_0_50.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_middle_grey_0_50.jpg\" alt=\"flowers\"></a> <em>Gamut clipping test</em></p>\n</div>\n</div>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"1.2em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\large \\alpha = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.773328em;\"></span><span class=\"strut bottom\" style=\"height:0.773328em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size6 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></p>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/redslices/adaptive_middle_grey_5_00.png\" alt=\"30\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>3</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=30^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">3</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/yellowgreenslices/adaptive_middle_grey_5_00.png\" alt=\"120\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>1</mn><mn>2</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=120^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column is-half\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_middle_grey_5_00.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_middle_grey_5_00.jpg\" alt=\"flowers\"></a> <em>Gamut clipping test</em></p>\n</div>\n</div>\n<br/>\n<h4 id=\"adaptive-%2C-hue-dependent\">Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">L_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span>, hue dependent <a class=\"anchor-link\" href=\"#adaptive-%2C-hue-dependent\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>This method blends between pure chroma compression and projection towards a single point, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>C</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L_0=L_{cusp}, C_0=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.969438em;vertical-align:-0.286108em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mpunct\">,</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span></span></span></span></p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">L_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span> is computed with the following equations:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mi>d</mi></msub><mo>=</mo><msub><mi>L</mi><mn>1</mn></msub><mo>−</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">L_d = L_1-L_{cusp} \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.969438em;vertical-align:-0.286108em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">−</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>k</mi><mo>=</mo><mn>2</mn><mrow><mo fence=\"true\">{</mo><mtable><mtr><mtd><mrow><mo>(</mo><mn>1</mn><mo>−</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub><mo>)</mo></mrow></mtd><mtd><mrow><mtext><mi mathvariant=\"normal\">i</mi><mi mathvariant=\"normal\">f</mi><mtext> </mtext></mtext><msub><mi>L</mi><mi>d</mi></msub><mo>&gt;</mo><mo>=</mo><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mrow></mtd><mtd><mrow><mtext><mi mathvariant=\"normal\">i</mi><mi mathvariant=\"normal\">f</mi><mtext> </mtext></mtext><msub><mi>L</mi><mi>d</mi></msub><mo>&lt;</mo><mn>0</mn></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding=\"application/x-tex\"> k = 2 \\begin{cases}\n  (1-L_{cusp}) &amp;\\text{if } L_d &gt;= 0 \\\\\n  L_{cusp} &amp;\\text{if } L_d &lt; 0\n\\end{cases} </annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:1.75em;\"></span><span class=\"strut bottom\" style=\"height:3.0000299999999998em;vertical-align:-1.25003em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.03148em;\">k</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">2</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\" style=\"top:0em;\"><span class=\"delimsizing size4\">{</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-l\"><span class=\"vlist\"><span style=\"top:-0.6819999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord mathrm\">1</span><span class=\"mbin\">−</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:0.7579999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"arraycolsep\" style=\"width:1em;\"></span><span class=\"col-align-l\"><span class=\"vlist\"><span style=\"top:-0.6819999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"text mord displaystyle textstyle uncramped\"><span class=\"mord mathrm\">i</span><span class=\"mord mathrm\" style=\"margin-right:0.07778em;\">f</span><span class=\"mord mspace\"> </span></span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">&gt;</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span></span></span><span style=\"top:0.7579999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"text mord displaystyle textstyle uncramped\"><span class=\"mord mathrm\">i</span><span class=\"mord mathrm\" style=\"margin-right:0.07778em;\">f</span><span class=\"mord mspace\"> </span></span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">&lt;</span><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter\"></span></span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>=</mo><mfrac><mi>k</mi><mn>2</mn></mfrac><mo>+</mo><mi mathvariant=\"normal\">∣</mi><msub><mi>L</mi><mi>d</mi></msub><mi mathvariant=\"normal\">∣</mi><mo>+</mo><mfrac><mrow><mi>α</mi><msub><mi>C</mi><mn>1</mn></msub></mrow><mi>k</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">e_1 = \\frac k 2 + |L_d| + \\frac {\\alpha C_1} k \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:1.37144em;\"></span><span class=\"strut bottom\" style=\"height:2.05744em;vertical-align:-0.686em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">e</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord reset-textstyle displaystyle textstyle uncramped\"><span class=\"sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist\"><span style=\"top:0.686em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle textstyle cramped\"><span class=\"mord mathrm\">2</span></span></span><span style=\"top:-0.22999999999999998em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped frac-line\"></span></span><span style=\"top:-0.677em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.03148em;\">k</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter\"></span></span><span class=\"mbin\">+</span><span class=\"mord mathrm\">∣</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathrm\">∣</span><span class=\"mbin\">+</span><span class=\"mord reset-textstyle displaystyle textstyle uncramped\"><span class=\"sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist\"><span style=\"top:0.686em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle textstyle cramped\"><span class=\"mord mathit\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-0.22999999999999998em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped frac-line\"></span></span><span style=\"top:-0.677em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped\"><span class=\"mord textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter\"></span></span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub><mo>+</mo><mfrac><mrow><mi>s</mi><mi>g</mi><mi>n</mi><mo>(</mo><msub><mi>L</mi><mi>d</mi></msub><mo>)</mo><mo>(</mo><msub><mi>e</mi><mn>1</mn></msub><mo>−</mo><msqrt><mrow><msubsup><mi>e</mi><mn>1</mn><mn>2</mn></msubsup><mo>−</mo><mn>2</mn><mi>k</mi><mi mathvariant=\"normal\">∣</mi><msub><mi>L</mi><mi>d</mi></msub><mi mathvariant=\"normal\">∣</mi></mrow></msqrt><mo>)</mo></mrow><mn>2</mn></mfrac><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><msub><mi>C</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L_0 = L_{cusp} + \\frac {sgn(L_d)(e_1 - \\sqrt{e_1^2 - 2 k |L_d|})} 2 ,\\qquad C_0 = 0 \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:1.63001em;\"></span><span class=\"strut bottom\" style=\"height:2.31601em;vertical-align:-0.686em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">+</span><span class=\"mord reset-textstyle displaystyle textstyle uncramped\"><span class=\"sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist\"><span style=\"top:0.686em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"reset-textstyle textstyle cramped\"><span class=\"mord mathrm\">2</span></span></span><span style=\"top:-0.22999999999999998em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped frac-line\"></span></span><span style=\"top:-0.680205em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped\"><span class=\"mord textstyle uncramped\"><span class=\"mord mathit\">s</span><span class=\"mord mathit\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathit\">n</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">e</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">−</span><span class=\"sqrt mord\"><span class=\"sqrt-sign\" style=\"top:-0.05980500000000011em;\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing size1\">√</span></span></span><span class=\"vlist\"><span style=\"top:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"mord textstyle cramped\"><span class=\"mord\"><span class=\"mord mathit\">e</span><span class=\"vlist\"><span style=\"top:0.26630799999999993em;margin-left:0em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">1</span></span></span><span style=\"top:-0.34480000000000005em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">−</span><span class=\"mord mathrm\">2</span><span class=\"mord mathit\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathrm\">∣</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathit\">d</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mord mathrm\">∣</span></span></span><span style=\"top:-0.869805em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped sqrt-line\"></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span>​</span></span></span><span class=\"sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter\"></span></span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.07153em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span></span></span></span></span></p>\n<p>Here are some results with different values for <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span></span></span></span>:</p>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"1.2em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\large \\alpha = 0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.773328em;\"></span><span class=\"strut bottom\" style=\"height:0.773328em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size6 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></p>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/redslices/adaptive_L_cusp_0_05.png\" alt=\"30\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>3</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=30^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">3</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/yellowgreenslices/adaptive_L_cusp_0_05.png\" alt=\"120\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>1</mn><mn>2</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=120^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column is-half\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_L_cusp_0_05.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_L_cusp_0_05.jpg\" alt=\"flowers\"></a> <em>Gamut clipping test</em></p>\n</div>\n</div>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"1.2em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\large \\alpha = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.773328em;\"></span><span class=\"strut bottom\" style=\"height:0.773328em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size6 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></p>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/redslices/adaptive_L_cusp_0_50.png\" alt=\"30\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>3</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=30^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">3</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/yellowgreenslices/adaptive_L_cusp_0_50.png\" alt=\"120\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>1</mn><mn>2</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=120^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column is-half\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_L_cusp_0_50.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_L_cusp_0_50.jpg\" alt=\"flowers\"></a> <em>Gamut clipping test</em></p>\n</div>\n</div>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"1.2em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\large \\alpha = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.773328em;\"></span><span class=\"strut bottom\" style=\"height:0.773328em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size6 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></p>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/redslices/adaptive_L_cusp_5_00.png\" alt=\"30\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>3</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=30^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">3</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column\">\n<p><img src=\"/img/gamutclipping/yellowgreenslices/adaptive_L_cusp_5_00.png\" alt=\"120\"> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mn>1</mn><mn>2</mn><msup><mn>0</mn><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}=120^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord\"><span class=\"mord mathrm\">0</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></p>\n</div>\n<div class=\"column is-half\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_L_cusp_5_00.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_L_cusp_5_00.jpg\" alt=\"flowers\"></a> <em>Gamut clipping test</em></p>\n</div>\n</div>\n<br/>\n<h2 id=\"results\">Results <a class=\"anchor-link\" href=\"#results\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h2>\n<p>The following images compare RGB clipping with the five different gamut mapping methods above and a few choices of <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span></span></span></span>, across different images. All images have had their colorfulness increased by scaling Oklab chroma and their exposure increased slightly.</p>\n<p>The processing done here is for testing purposes only. I would not recommend doing image processing that creates this many invalid colors and solving it by gamut clipping. For example, in cases like this, some kind of gamut compressions would probably be a better choice.</p>\n<p>All the original photos are by me and bot original images are results are licensed under <a href=\"https://creativecommons.org/licenses/by-sa/4.0/\">CC BY-SA</a>.</p>\n<h3 id=\"flowers\">Flowers <a class=\"anchor-link\" href=\"#flowers\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/original.jpg\"><img src=\"/img/gamutclipping/flowers/original.jpg\" alt=\"Original\"></a> <em>Unprocessed</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/out_of_gamut.jpg\"><img src=\"/img/gamutclipping/flowers/out_of_gamut.jpg\" alt=\"Colors in gamut\"></a> <em>Colors in gamut</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/clipped_rgb.jpg\"><img src=\"/img/gamutclipping/flowers/clipped_rgb.jpg\" alt=\"Clipped in RGB\"></a> <em>RGB clipped</em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/clipped_chroma.jpg\"><img src=\"/img/gamutclipping/flowers/clipped_chroma.jpg\" alt=\"Chroma clipped\"></a> <em>Chroma clipped</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/sp_middle_grey.jpg\"><img src=\"/img/gamutclipping/flowers/sp_middle_grey.jpg\" alt=\"Middle grey projection\"></a> <em><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span> projection</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/sp_L_cusp.jpg\"><img src=\"/img/gamutclipping/flowers/sp_L_cusp.jpg\" alt=\"L_cusp projection\"></a> <em><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span> projection</em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_middle_grey_0_05.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_middle_grey_0_05.jpg\" alt=\"Adaptive 0.5 0.05\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_middle_grey_0_50.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_middle_grey_0_50.jpg\" alt=\"Adaptive 0.5 0.50\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_middle_grey_5_00.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_middle_grey_5_00.jpg\" alt=\"Adaptive 0.5 5.00\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>5</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=5.00</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_L_cusp_0_05.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_L_cusp_0_05.jpg\" alt=\"Adaptive L_cusp 0.05\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_L_cusp_0_50.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_L_cusp_0_50.jpg\" alt=\"Adaptive L_cusp 0.50\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/flowers/adaptive_L_cusp_5_00.jpg\"><img src=\"/img/gamutclipping/flowers/adaptive_L_cusp_5_00.jpg\" alt=\"Adaptive L_cusp 5.00\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>5</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=5.00</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n</div>\n<h3 id=\"lamp\">Lamp <a class=\"anchor-link\" href=\"#lamp\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/original.jpg\"><img src=\"/img/gamutclipping/lamp/original.jpg\" alt=\"Original\"></a> <em>Unprocessed</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/out_of_gamut.jpg\"><img src=\"/img/gamutclipping/lamp/out_of_gamut.jpg\" alt=\"Colors in gamut\"></a> <em>Colors in gamut</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/clipped_rgb.jpg\"><img src=\"/img/gamutclipping/lamp/clipped_rgb.jpg\" alt=\"Clipped in RGB\"></a> <em>RGB clipped</em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/clipped_chroma.jpg\"><img src=\"/img/gamutclipping/lamp/clipped_chroma.jpg\" alt=\"Chroma clipped\"></a> <em>Chroma clipped</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/sp_middle_grey.jpg\"><img src=\"/img/gamutclipping/lamp/sp_middle_grey.jpg\" alt=\"Middle grey projection\"></a> <em><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span> projection</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/sp_L_cusp.jpg\"><img src=\"/img/gamutclipping/lamp/sp_L_cusp.jpg\" alt=\"L_cusp projection\"></a> <em><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span> projection</em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/adaptive_middle_grey_0_05.jpg\"><img src=\"/img/gamutclipping/lamp/adaptive_middle_grey_0_05.jpg\" alt=\"Adaptive 0.5 0.05\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/adaptive_middle_grey_0_50.jpg\"><img src=\"/img/gamutclipping/lamp/adaptive_middle_grey_0_50.jpg\" alt=\"Adaptive 0.5 0.50\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/adaptive_middle_grey_5_00.jpg\"><img src=\"/img/gamutclipping/lamp/adaptive_middle_grey_5_00.jpg\" alt=\"Adaptive 0.5 5.00\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>5</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=5.00</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/adaptive_L_cusp_0_05.jpg\"><img src=\"/img/gamutclipping/lamp/adaptive_L_cusp_0_05.jpg\" alt=\"Adaptive L_cusp 0.05\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/adaptive_L_cusp_0_50.jpg\"><img src=\"/img/gamutclipping/lamp/adaptive_L_cusp_0_50.jpg\" alt=\"Adaptive L_cusp 0.50\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/lamp/adaptive_L_cusp_5_00.jpg\"><img src=\"/img/gamutclipping/lamp/adaptive_L_cusp_5_00.jpg\" alt=\"Adaptive L_cusp 5.00\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>5</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=5.00</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n</div>\n<h3 id=\"tulip\">Tulip <a class=\"anchor-link\" href=\"#tulip\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/original.jpg\"><img src=\"/img/gamutclipping/tulip/original.jpg\" alt=\"Original\"></a> <em>Unprocessed</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/out_of_gamut.jpg\"><img src=\"/img/gamutclipping/tulip/out_of_gamut.jpg\" alt=\"Colors in gamut\"></a> <em>Colors in gamut</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/clipped_rgb.jpg\"><img src=\"/img/gamutclipping/tulip/clipped_rgb.jpg\" alt=\"Clipped in RGB\"></a> <em>RGB clipped</em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/clipped_chroma.jpg\"><img src=\"/img/gamutclipping/tulip/clipped_chroma.jpg\" alt=\"Chroma clipped\"></a> <em>Chroma clipped</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/sp_middle_grey.jpg\"><img src=\"/img/gamutclipping/tulip/sp_middle_grey.jpg\" alt=\"Middle grey projection\"></a> <em><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span> projection</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/sp_L_cusp.jpg\"><img src=\"/img/gamutclipping/tulip/sp_L_cusp.jpg\" alt=\"L_cusp projection\"></a> <em><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span> projection</em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/adaptive_middle_grey_0_05.jpg\"><img src=\"/img/gamutclipping/tulip/adaptive_middle_grey_0_05.jpg\" alt=\"Adaptive 0.5 0.05\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/adaptive_middle_grey_0_50.jpg\"><img src=\"/img/gamutclipping/tulip/adaptive_middle_grey_0_50.jpg\" alt=\"Adaptive 0.5 0.50\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/adaptive_middle_grey_5_00.jpg\"><img src=\"/img/gamutclipping/tulip/adaptive_middle_grey_5_00.jpg\" alt=\"Adaptive 0.5 5.00\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>5</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=5.00</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/adaptive_L_cusp_0_05.jpg\"><img src=\"/img/gamutclipping/tulip/adaptive_L_cusp_0_05.jpg\" alt=\"Adaptive L_cusp 0.05\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/adaptive_L_cusp_0_50.jpg\"><img src=\"/img/gamutclipping/tulip/adaptive_L_cusp_0_50.jpg\" alt=\"Adaptive L_cusp 0.50\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/tulip/adaptive_L_cusp_5_00.jpg\"><img src=\"/img/gamutclipping/tulip/adaptive_L_cusp_5_00.jpg\" alt=\"Adaptive L_cusp 5.00\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>5</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=5.00</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n</div>\n<h3 id=\"boat\">Boat <a class=\"anchor-link\" href=\"#boat\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/original.jpg\"><img src=\"/img/gamutclipping/boat/original.jpg\" alt=\"Original\"></a> <em>Unprocessed</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/out_of_gamut.jpg\"><img src=\"/img/gamutclipping/boat/out_of_gamut.jpg\" alt=\"Colors in gamut\"></a> <em>Colors in gamut</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/clipped_rgb.jpg\"><img src=\"/img/gamutclipping/boat/clipped_rgb.jpg\" alt=\"Clipped in RGB\"></a> <em>RGB clipped</em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/clipped_chroma.jpg\"><img src=\"/img/gamutclipping/boat/clipped_chroma.jpg\" alt=\"Chroma clipped\"></a> <em>Chroma clipped</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/sp_middle_grey.jpg\"><img src=\"/img/gamutclipping/boat/sp_middle_grey.jpg\" alt=\"Middle grey projection\"></a> <em><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span> projection</em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/sp_L_cusp.jpg\"><img src=\"/img/gamutclipping/boat/sp_L_cusp.jpg\" alt=\"L_cusp projection\"></a> <em><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span> projection</em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/adaptive_middle_grey_0_05.jpg\"><img src=\"/img/gamutclipping/boat/adaptive_middle_grey_0_05.jpg\" alt=\"Adaptive 0.5 0.05\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/adaptive_middle_grey_0_50.jpg\"><img src=\"/img/gamutclipping/boat/adaptive_middle_grey_0_50.jpg\" alt=\"Adaptive 0.5 0.50\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/adaptive_middle_grey_5_00.jpg\"><img src=\"/img/gamutclipping/boat/adaptive_middle_grey_5_00.jpg\" alt=\"Adaptive 0.5 5.00\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.749997em;vertical-align:-0.135em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>5</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=5.00</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n</div>\n<div class=\"columns has-background-grey-lighter\">\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/adaptive_L_cusp_0_05.jpg\"><img src=\"/img/gamutclipping/boat/adaptive_L_cusp_0_05.jpg\" alt=\"Adaptive L_cusp 0.05\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/adaptive_L_cusp_0_50.jpg\"><img src=\"/img/gamutclipping/boat/adaptive_L_cusp_0_50.jpg\" alt=\"Adaptive L_cusp 0.50\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=0.50</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n<div class=\"column\">\n<p><a href=\"/img/gamutclipping/boat/adaptive_L_cusp_5_00.jpg\"><img src=\"/img/gamutclipping/boat/adaptive_L_cusp_5_00.jpg\" alt=\"Adaptive L_cusp 5.00\"></a> <em>Adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.614997em;\"></span><span class=\"strut bottom\" style=\"height:0.8724942em;vertical-align:-0.2574972em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size4 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mstyle mathsize=\"0.9em\"><mi>α</mi><mo>=</mo><mn>5</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>0</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\small \\alpha=5.00</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.5799960000000001em;\"></span><span class=\"strut bottom\" style=\"height:0.5799960000000001em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"sizing reset-size5 size4 textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span></span></span></span></span></span></em></p>\n</div>\n</div>\n<h2 id=\"conclusions-and-future-work\">Conclusions and future work <a class=\"anchor-link\" href=\"#conclusions-and-future-work\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h2>\n<p>Overall, doing gamut clipping using Oklab seems like a useful tool, and is fairly easy to implement. The results here though are not enough to determine how it compares with other algorithm or how results are perceived if comparing wide gamut images with clipped versions. Doing more studies and comparisons would be interesting.</p>\n<p>Personally, of the methods evaluated here I think a good default choice would be adaptive <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">L_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span> with <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">\\alpha = 0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.64444em;\"></span><span class=\"strut bottom\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span>, but in specific cases other methods and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span></span></span></span> values can definitely perform better. At <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>α</mi><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">\\alpha = 0.05</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.64444em;\"></span><span class=\"strut bottom\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.0037em;\">α</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span></span></span></span> the choice between <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>c</mi><mi>u</mi><mi>s</mi><mi>p</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">L_0 = L_{cusp}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.969438em;vertical-align:-0.286108em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\">c</span><span class=\"mord mathit\">u</span><span class=\"mord mathit\">s</span><span class=\"mord mathit\">p</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span> seems to matter very little visually. <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">L_0 = 0.5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">5</span></span></span></span> is then preferable, since it is cheaper to compute, and can be implemented with a single 2D lookup table if desired (From hue and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">L_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">L</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span></span></span></span>).</p>\n<p>There is also a lot of potential future work:</p>\n<ul>\n<li>Would be nice with a solution that could work directly with RGB matrices, instead of optimizing some constants separately. This way a solutions could be created quickly for any RGB color space.</li>\n<li>One issue, that is related to the sRGB gamut rather than the clipping algorithm, is the sharp ridges of high chroma that sometimes get created. A smoothed version of the sRGB gamut could be interesting to clip to instead, producing a more even blend at the expense of some of the highly saturated colors.</li>\n<li>There are also a lot of other applications for intersecting lines with the gamut to explore.</li>\n</ul>\n<p>My next post will be about creating HSV and HSL like color pickers with improved uniformity, utilizing the gamut intersection algorithm described here.</p>\n<h2 id=\"source-code\">Source code <a class=\"anchor-link\" href=\"#source-code\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h2>\n<p>All the source code on this page is provided under the MIT license:</p>\n<pre><code>Copyright (c) 2021 Björn Ottosson\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the &quot;Software&quot;), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\nof the Software, and to permit persons to whom the Software is furnished to do\nso, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n</code></pre>\n<h4 id=\"oklab-to-linear-srgb-conversion\">Oklab to linear sRGB conversion <a class=\"anchor-link\" href=\"#oklab-to-linear-srgb-conversion\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Linear sRGB to Oklab conversion, identical to the <a href=\"https://bottosson.github.io/posts/oklab/\">the Oklab blog post</a>.</p>\n<p>This is using linear sRGB values in the range 0.0 to 1.0. To compute linear sRGB values, see <a href=\"https://bottosson.github.io/posts/colorwrong/#what-can-we-do%3F\">my previous post</a>.</p>\n<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Lab</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">float</span> L<span class=\"token punctuation\">;</span> <span class=\"token keyword\">float</span> a<span class=\"token punctuation\">;</span> <span class=\"token keyword\">float</span> b<span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">struct</span> <span class=\"token class-name\">RGB</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">float</span> r<span class=\"token punctuation\">;</span> <span class=\"token keyword\">float</span> g<span class=\"token punctuation\">;</span> <span class=\"token keyword\">float</span> b<span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br><br>Lab <span class=\"token function\">linear_srgb_to_oklab</span><span class=\"token punctuation\">(</span>RGB c<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token keyword\">float</span> l <span class=\"token operator\">=</span> <span class=\"token number\">0.4122214708f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>r <span class=\"token operator\">+</span> <span class=\"token number\">0.5363325363f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>g <span class=\"token operator\">+</span> <span class=\"token number\">0.0514459929f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> m <span class=\"token operator\">=</span> <span class=\"token number\">0.2119034982f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>r <span class=\"token operator\">+</span> <span class=\"token number\">0.6806995451f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>g <span class=\"token operator\">+</span> <span class=\"token number\">0.1073969566f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> s <span class=\"token operator\">=</span> <span class=\"token number\">0.0883024619f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>r <span class=\"token operator\">+</span> <span class=\"token number\">0.2817188376f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>g <span class=\"token operator\">+</span> <span class=\"token number\">0.6299787005f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> l_ <span class=\"token operator\">=</span> <span class=\"token function\">cbrtf</span><span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> m_ <span class=\"token operator\">=</span> <span class=\"token function\">cbrtf</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> s_ <span class=\"token operator\">=</span> <span class=\"token function\">cbrtf</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><br>\t\t<span class=\"token number\">0.2104542553f</span> <span class=\"token operator\">*</span> l_ <span class=\"token operator\">+</span> <span class=\"token number\">0.7936177850f</span> <span class=\"token operator\">*</span> m_ <span class=\"token operator\">-</span> <span class=\"token number\">0.0040720468f</span> <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">,</span><br>\t\t<span class=\"token number\">1.9779984951f</span> <span class=\"token operator\">*</span> l_ <span class=\"token operator\">-</span> <span class=\"token number\">2.4285922050f</span> <span class=\"token operator\">*</span> m_ <span class=\"token operator\">+</span> <span class=\"token number\">0.4505937099f</span> <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">,</span><br>\t\t<span class=\"token number\">0.0259040371f</span> <span class=\"token operator\">*</span> l_ <span class=\"token operator\">+</span> <span class=\"token number\">0.7827717662f</span> <span class=\"token operator\">*</span> m_ <span class=\"token operator\">-</span> <span class=\"token number\">0.8086757660f</span> <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">,</span><br>\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br>RGB <span class=\"token function\">oklab_to_linear_srgb</span><span class=\"token punctuation\">(</span>Lab c<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>    <span class=\"token keyword\">float</span> l_ <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span>L <span class=\"token operator\">+</span> <span class=\"token number\">0.3963377774f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> <span class=\"token number\">0.2158037573f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> m_ <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span>L <span class=\"token operator\">-</span> <span class=\"token number\">0.1055613458f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>a <span class=\"token operator\">-</span> <span class=\"token number\">0.0638541728f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> s_ <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span>L <span class=\"token operator\">-</span> <span class=\"token number\">0.0894841775f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>a <span class=\"token operator\">-</span> <span class=\"token number\">1.2914855480f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br><br>    <span class=\"token keyword\">float</span> l <span class=\"token operator\">=</span> l_ <span class=\"token operator\">*</span> l_ <span class=\"token operator\">*</span> l_<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> m <span class=\"token operator\">=</span> m_ <span class=\"token operator\">*</span> m_ <span class=\"token operator\">*</span> m_<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> s <span class=\"token operator\">=</span> s_ <span class=\"token operator\">*</span> s_ <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">;</span><br><br>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><br>        <span class=\"token operator\">+</span><span class=\"token number\">4.0767416621f</span> <span class=\"token operator\">*</span> l <span class=\"token operator\">-</span> <span class=\"token number\">3.3077115913f</span> <span class=\"token operator\">*</span> m <span class=\"token operator\">+</span> <span class=\"token number\">0.2309699292f</span> <span class=\"token operator\">*</span> s<span class=\"token punctuation\">,</span><br>        <span class=\"token operator\">-</span><span class=\"token number\">1.2684380046f</span> <span class=\"token operator\">*</span> l <span class=\"token operator\">+</span> <span class=\"token number\">2.6097574011f</span> <span class=\"token operator\">*</span> m <span class=\"token operator\">-</span> <span class=\"token number\">0.3413193965f</span> <span class=\"token operator\">*</span> s<span class=\"token punctuation\">,</span><br>        <span class=\"token operator\">-</span><span class=\"token number\">0.0041960863f</span> <span class=\"token operator\">*</span> l <span class=\"token operator\">-</span> <span class=\"token number\">0.7034186147f</span> <span class=\"token operator\">*</span> m <span class=\"token operator\">+</span> <span class=\"token number\">1.7076147010f</span> <span class=\"token operator\">*</span> s<span class=\"token punctuation\">,</span><br>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span></code></pre>\n<h4 id=\"intersection-with-srgb-gamut\">Intersection with sRGB gamut <a class=\"anchor-link\" href=\"#intersection-with-srgb-gamut\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Implementations of the sRGB gamut intersection algorithm. The code has been written to be easy to follow. Consider optimizing for your use case.</p>\n<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// Finds the maximum saturation possible for a given hue that fits in sRGB</span><br><span class=\"token comment\">// Saturation here is defined as S = C/L</span><br><span class=\"token comment\">// a and b must be normalized so a^2 + b^2 == 1</span><br><span class=\"token keyword\">float</span> <span class=\"token function\">compute_max_saturation</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> b<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>    <span class=\"token comment\">// Max saturation will be when one of r, g or b goes below zero.</span><br><br>    <span class=\"token comment\">// Select different coefficients depending on which component goes below zero first</span><br>    <span class=\"token keyword\">float</span> k0<span class=\"token punctuation\">,</span> k1<span class=\"token punctuation\">,</span> k2<span class=\"token punctuation\">,</span> k3<span class=\"token punctuation\">,</span> k4<span class=\"token punctuation\">,</span> wl<span class=\"token punctuation\">,</span> wm<span class=\"token punctuation\">,</span> ws<span class=\"token punctuation\">;</span><br><br>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1.88170328f</span> <span class=\"token operator\">*</span> a <span class=\"token operator\">-</span> <span class=\"token number\">0.80936493f</span> <span class=\"token operator\">*</span> b <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><br>    <span class=\"token punctuation\">{</span><br>        <span class=\"token comment\">// Red component</span><br>        k0 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">1.19086277f</span><span class=\"token punctuation\">;</span> k1 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">1.76576728f</span><span class=\"token punctuation\">;</span> k2 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.59662641f</span><span class=\"token punctuation\">;</span> k3 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.75515197f</span><span class=\"token punctuation\">;</span> k4 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.56771245f</span><span class=\"token punctuation\">;</span><br>        wl <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">4.0767416621f</span><span class=\"token punctuation\">;</span> wm <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">3.3077115913f</span><span class=\"token punctuation\">;</span> ws <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.2309699292f</span><span class=\"token punctuation\">;</span><br>    <span class=\"token punctuation\">}</span><br>    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1.81444104f</span> <span class=\"token operator\">*</span> a <span class=\"token operator\">-</span> <span class=\"token number\">1.19445276f</span> <span class=\"token operator\">*</span> b <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><br>    <span class=\"token punctuation\">{</span><br>        <span class=\"token comment\">// Green component</span><br>        k0 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.73956515f</span><span class=\"token punctuation\">;</span> k1 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.45954404f</span><span class=\"token punctuation\">;</span> k2 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.08285427f</span><span class=\"token punctuation\">;</span> k3 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.12541070f</span><span class=\"token punctuation\">;</span> k4 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.14503204f</span><span class=\"token punctuation\">;</span><br>        wl <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1.2681437731f</span><span class=\"token punctuation\">;</span> wm <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">2.6097574011f</span><span class=\"token punctuation\">;</span> ws <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.3413193965f</span><span class=\"token punctuation\">;</span><br>    <span class=\"token punctuation\">}</span><br>    <span class=\"token keyword\">else</span><br>    <span class=\"token punctuation\">{</span><br>        <span class=\"token comment\">// Blue component</span><br>        k0 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">1.35733652f</span><span class=\"token punctuation\">;</span> k1 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.00915799f</span><span class=\"token punctuation\">;</span> k2 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1.15130210f</span><span class=\"token punctuation\">;</span> k3 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.50559606f</span><span class=\"token punctuation\">;</span> k4 <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.00692167f</span><span class=\"token punctuation\">;</span><br>        wl <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.0041960863f</span><span class=\"token punctuation\">;</span> wm <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.7034186147f</span><span class=\"token punctuation\">;</span> ws <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">1.7076147010f</span><span class=\"token punctuation\">;</span><br>    <span class=\"token punctuation\">}</span><br><br>    <span class=\"token comment\">// Approximate max saturation using a polynomial:</span><br>    <span class=\"token keyword\">float</span> S <span class=\"token operator\">=</span> k0 <span class=\"token operator\">+</span> k1 <span class=\"token operator\">*</span> a <span class=\"token operator\">+</span> k2 <span class=\"token operator\">*</span> b <span class=\"token operator\">+</span> k3 <span class=\"token operator\">*</span> a <span class=\"token operator\">*</span> a <span class=\"token operator\">+</span> k4 <span class=\"token operator\">*</span> a <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span><br><br>    <span class=\"token comment\">// Do one step Halley's method to get closer</span><br>    <span class=\"token comment\">// this gives an error less than 10e6, except for some blue hues where the dS/dh is close to infinite</span><br>    <span class=\"token comment\">// this should be sufficient for most applications, otherwise do two/three steps </span><br><br>    <span class=\"token keyword\">float</span> k_l <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.3963377774f</span> <span class=\"token operator\">*</span> a <span class=\"token operator\">+</span> <span class=\"token number\">0.2158037573f</span> <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> k_m <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.1055613458f</span> <span class=\"token operator\">*</span> a <span class=\"token operator\">-</span> <span class=\"token number\">0.0638541728f</span> <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> k_s <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.0894841775f</span> <span class=\"token operator\">*</span> a <span class=\"token operator\">-</span> <span class=\"token number\">1.2914855480f</span> <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span><br><br>    <span class=\"token punctuation\">{</span><br>        <span class=\"token keyword\">float</span> l_ <span class=\"token operator\">=</span> <span class=\"token number\">1.f</span> <span class=\"token operator\">+</span> S <span class=\"token operator\">*</span> k_l<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> m_ <span class=\"token operator\">=</span> <span class=\"token number\">1.f</span> <span class=\"token operator\">+</span> S <span class=\"token operator\">*</span> k_m<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> s_ <span class=\"token operator\">=</span> <span class=\"token number\">1.f</span> <span class=\"token operator\">+</span> S <span class=\"token operator\">*</span> k_s<span class=\"token punctuation\">;</span><br><br>        <span class=\"token keyword\">float</span> l <span class=\"token operator\">=</span> l_ <span class=\"token operator\">*</span> l_ <span class=\"token operator\">*</span> l_<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> m <span class=\"token operator\">=</span> m_ <span class=\"token operator\">*</span> m_ <span class=\"token operator\">*</span> m_<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> s <span class=\"token operator\">=</span> s_ <span class=\"token operator\">*</span> s_ <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">;</span><br><br>        <span class=\"token keyword\">float</span> l_dS <span class=\"token operator\">=</span> <span class=\"token number\">3.f</span> <span class=\"token operator\">*</span> k_l <span class=\"token operator\">*</span> l_ <span class=\"token operator\">*</span> l_<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> m_dS <span class=\"token operator\">=</span> <span class=\"token number\">3.f</span> <span class=\"token operator\">*</span> k_m <span class=\"token operator\">*</span> m_ <span class=\"token operator\">*</span> m_<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> s_dS <span class=\"token operator\">=</span> <span class=\"token number\">3.f</span> <span class=\"token operator\">*</span> k_s <span class=\"token operator\">*</span> s_ <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">;</span><br><br>        <span class=\"token keyword\">float</span> l_dS2 <span class=\"token operator\">=</span> <span class=\"token number\">6.f</span> <span class=\"token operator\">*</span> k_l <span class=\"token operator\">*</span> k_l <span class=\"token operator\">*</span> l_<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> m_dS2 <span class=\"token operator\">=</span> <span class=\"token number\">6.f</span> <span class=\"token operator\">*</span> k_m <span class=\"token operator\">*</span> k_m <span class=\"token operator\">*</span> m_<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> s_dS2 <span class=\"token operator\">=</span> <span class=\"token number\">6.f</span> <span class=\"token operator\">*</span> k_s <span class=\"token operator\">*</span> k_s <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">;</span><br><br>        <span class=\"token keyword\">float</span> f  <span class=\"token operator\">=</span> wl <span class=\"token operator\">*</span> l     <span class=\"token operator\">+</span> wm <span class=\"token operator\">*</span> m     <span class=\"token operator\">+</span> ws <span class=\"token operator\">*</span> s<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> f1 <span class=\"token operator\">=</span> wl <span class=\"token operator\">*</span> l_dS  <span class=\"token operator\">+</span> wm <span class=\"token operator\">*</span> m_dS  <span class=\"token operator\">+</span> ws <span class=\"token operator\">*</span> s_dS<span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">float</span> f2 <span class=\"token operator\">=</span> wl <span class=\"token operator\">*</span> l_dS2 <span class=\"token operator\">+</span> wm <span class=\"token operator\">*</span> m_dS2 <span class=\"token operator\">+</span> ws <span class=\"token operator\">*</span> s_dS2<span class=\"token punctuation\">;</span><br><br>        S <span class=\"token operator\">=</span> S <span class=\"token operator\">-</span> f <span class=\"token operator\">*</span> f1 <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>f1<span class=\"token operator\">*</span>f1 <span class=\"token operator\">-</span> <span class=\"token number\">0.5f</span> <span class=\"token operator\">*</span> f <span class=\"token operator\">*</span> f2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token punctuation\">}</span><br><br>    <span class=\"token keyword\">return</span> S<span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br><span class=\"token comment\">// finds L_cusp and C_cusp for a given hue</span><br><span class=\"token comment\">// a and b must be normalized so a^2 + b^2 == 1</span><br><span class=\"token keyword\">struct</span> <span class=\"token class-name\">LC</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">float</span> L<span class=\"token punctuation\">;</span> <span class=\"token keyword\">float</span> C<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br>LC <span class=\"token function\">find_cusp</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> b<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token comment\">// First, find the maximum saturation (saturation S = C/L)</span><br>\t<span class=\"token keyword\">float</span> S_cusp <span class=\"token operator\">=</span> <span class=\"token function\">compute_max_saturation</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token comment\">// Convert to linear sRGB to find the first point where at least one of r,g or b >= 1:</span><br>\tRGB rgb_at_max <span class=\"token operator\">=</span> <span class=\"token function\">oklab_to_linear_srgb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> S_cusp <span class=\"token operator\">*</span> a<span class=\"token punctuation\">,</span> S_cusp <span class=\"token operator\">*</span> b <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> L_cusp <span class=\"token operator\">=</span> <span class=\"token function\">cbrtf</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.f</span> <span class=\"token operator\">/</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>rgb_at_max<span class=\"token punctuation\">.</span>r<span class=\"token punctuation\">,</span> rgb_at_max<span class=\"token punctuation\">.</span>g<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> rgb_at_max<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C_cusp <span class=\"token operator\">=</span> L_cusp <span class=\"token operator\">*</span> S_cusp<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> L_cusp <span class=\"token punctuation\">,</span> C_cusp <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br><span class=\"token comment\">// Finds intersection of the line defined by </span><br><span class=\"token comment\">// L = L0 * (1 - t) + t * L1;</span><br><span class=\"token comment\">// C = t * C1;</span><br><span class=\"token comment\">// a and b must be normalized so a^2 + b^2 == 1</span><br><span class=\"token keyword\">float</span> <span class=\"token function\">find_gamut_intersection</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> b<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> L1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> C1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> L0<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token comment\">// Find the cusp of the gamut triangle</span><br>\tLC cusp <span class=\"token operator\">=</span> <span class=\"token function\">find_cusp</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token comment\">// Find the intersection for upper and lower half seprately</span><br>\t<span class=\"token keyword\">float</span> t<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>L1 <span class=\"token operator\">-</span> L0<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> cusp<span class=\"token punctuation\">.</span>C <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>cusp<span class=\"token punctuation\">.</span>L <span class=\"token operator\">-</span> L0<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> C1<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0.f</span><span class=\"token punctuation\">)</span><br>\t<span class=\"token punctuation\">{</span><br>\t\t<span class=\"token comment\">// Lower half</span><br><br>\t\tt <span class=\"token operator\">=</span> cusp<span class=\"token punctuation\">.</span>C <span class=\"token operator\">*</span> L0 <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>C1 <span class=\"token operator\">*</span> cusp<span class=\"token punctuation\">.</span>L <span class=\"token operator\">+</span> cusp<span class=\"token punctuation\">.</span>C <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>L0 <span class=\"token operator\">-</span> L1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token punctuation\">}</span><br>\t<span class=\"token keyword\">else</span><br>\t<span class=\"token punctuation\">{</span><br>\t\t<span class=\"token comment\">// Upper half</span><br><br>\t\t<span class=\"token comment\">// First intersect with triangle</span><br>\t\tt <span class=\"token operator\">=</span> cusp<span class=\"token punctuation\">.</span>C <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>L0 <span class=\"token operator\">-</span> <span class=\"token number\">1.f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>C1 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>cusp<span class=\"token punctuation\">.</span>L <span class=\"token operator\">-</span> <span class=\"token number\">1.f</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> cusp<span class=\"token punctuation\">.</span>C <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>L0 <span class=\"token operator\">-</span> L1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t\t<span class=\"token comment\">// Then one step Halley's method</span><br>\t\t<span class=\"token punctuation\">{</span><br>\t\t\t<span class=\"token keyword\">float</span> dL <span class=\"token operator\">=</span> L1 <span class=\"token operator\">-</span> L0<span class=\"token punctuation\">;</span><br>\t\t\t<span class=\"token keyword\">float</span> dC <span class=\"token operator\">=</span> C1<span class=\"token punctuation\">;</span><br><br>\t\t\t<span class=\"token keyword\">float</span> k_l <span class=\"token operator\">=</span> <span class=\"token operator\">+</span><span class=\"token number\">0.3963377774f</span> <span class=\"token operator\">*</span> a <span class=\"token operator\">+</span> <span class=\"token number\">0.2158037573f</span> <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span><br>\t\t\t<span class=\"token keyword\">float</span> k_m <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.1055613458f</span> <span class=\"token operator\">*</span> a <span class=\"token operator\">-</span> <span class=\"token number\">0.0638541728f</span> <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span><br>\t\t\t<span class=\"token keyword\">float</span> k_s <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.0894841775f</span> <span class=\"token operator\">*</span> a <span class=\"token operator\">-</span> <span class=\"token number\">1.2914855480f</span> <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span><br><br>\t\t\t<span class=\"token keyword\">float</span> l_dt <span class=\"token operator\">=</span> dL <span class=\"token operator\">+</span> dC <span class=\"token operator\">*</span> k_l<span class=\"token punctuation\">;</span><br>\t\t\t<span class=\"token keyword\">float</span> m_dt <span class=\"token operator\">=</span> dL <span class=\"token operator\">+</span> dC <span class=\"token operator\">*</span> k_m<span class=\"token punctuation\">;</span><br>\t\t\t<span class=\"token keyword\">float</span> s_dt <span class=\"token operator\">=</span> dL <span class=\"token operator\">+</span> dC <span class=\"token operator\">*</span> k_s<span class=\"token punctuation\">;</span><br><br>\t\t\t<br>\t\t\t<span class=\"token comment\">// If higher accuracy is required, 2 or 3 iterations of the following block can be used:</span><br>\t\t\t<span class=\"token punctuation\">{</span><br>\t\t\t\t<span class=\"token keyword\">float</span> L <span class=\"token operator\">=</span> L0 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1.f</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> L1<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> C <span class=\"token operator\">=</span> t <span class=\"token operator\">*</span> C1<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> l_ <span class=\"token operator\">=</span> L <span class=\"token operator\">+</span> C <span class=\"token operator\">*</span> k_l<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> m_ <span class=\"token operator\">=</span> L <span class=\"token operator\">+</span> C <span class=\"token operator\">*</span> k_m<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> s_ <span class=\"token operator\">=</span> L <span class=\"token operator\">+</span> C <span class=\"token operator\">*</span> k_s<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> l <span class=\"token operator\">=</span> l_ <span class=\"token operator\">*</span> l_ <span class=\"token operator\">*</span> l_<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> m <span class=\"token operator\">=</span> m_ <span class=\"token operator\">*</span> m_ <span class=\"token operator\">*</span> m_<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> s <span class=\"token operator\">=</span> s_ <span class=\"token operator\">*</span> s_ <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> ldt <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> l_dt <span class=\"token operator\">*</span> l_ <span class=\"token operator\">*</span> l_<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> mdt <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> m_dt <span class=\"token operator\">*</span> m_ <span class=\"token operator\">*</span> m_<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> sdt <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> s_dt <span class=\"token operator\">*</span> s_ <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> ldt2 <span class=\"token operator\">=</span> <span class=\"token number\">6</span> <span class=\"token operator\">*</span> l_dt <span class=\"token operator\">*</span> l_dt <span class=\"token operator\">*</span> l_<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> mdt2 <span class=\"token operator\">=</span> <span class=\"token number\">6</span> <span class=\"token operator\">*</span> m_dt <span class=\"token operator\">*</span> m_dt <span class=\"token operator\">*</span> m_<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> sdt2 <span class=\"token operator\">=</span> <span class=\"token number\">6</span> <span class=\"token operator\">*</span> s_dt <span class=\"token operator\">*</span> s_dt <span class=\"token operator\">*</span> s_<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> r <span class=\"token operator\">=</span> <span class=\"token number\">4.0767416621f</span> <span class=\"token operator\">*</span> l <span class=\"token operator\">-</span> <span class=\"token number\">3.3077115913f</span> <span class=\"token operator\">*</span> m <span class=\"token operator\">+</span> <span class=\"token number\">0.2309699292f</span> <span class=\"token operator\">*</span> s <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> r1 <span class=\"token operator\">=</span> <span class=\"token number\">4.0767416621f</span> <span class=\"token operator\">*</span> ldt <span class=\"token operator\">-</span> <span class=\"token number\">3.3077115913f</span> <span class=\"token operator\">*</span> mdt <span class=\"token operator\">+</span> <span class=\"token number\">0.2309699292f</span> <span class=\"token operator\">*</span> sdt<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> r2 <span class=\"token operator\">=</span> <span class=\"token number\">4.0767416621f</span> <span class=\"token operator\">*</span> ldt2 <span class=\"token operator\">-</span> <span class=\"token number\">3.3077115913f</span> <span class=\"token operator\">*</span> mdt2 <span class=\"token operator\">+</span> <span class=\"token number\">0.2309699292f</span> <span class=\"token operator\">*</span> sdt2<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> u_r <span class=\"token operator\">=</span> r1 <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>r1 <span class=\"token operator\">*</span> r1 <span class=\"token operator\">-</span> <span class=\"token number\">0.5f</span> <span class=\"token operator\">*</span> r <span class=\"token operator\">*</span> r2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> t_r <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>r <span class=\"token operator\">*</span> u_r<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> g <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1.2681437731f</span> <span class=\"token operator\">*</span> l <span class=\"token operator\">+</span> <span class=\"token number\">2.6097574011f</span> <span class=\"token operator\">*</span> m <span class=\"token operator\">-</span> <span class=\"token number\">0.3413193965f</span> <span class=\"token operator\">*</span> s <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> g1 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1.2681437731f</span> <span class=\"token operator\">*</span> ldt <span class=\"token operator\">+</span> <span class=\"token number\">2.6097574011f</span> <span class=\"token operator\">*</span> mdt <span class=\"token operator\">-</span> <span class=\"token number\">0.3413193965f</span> <span class=\"token operator\">*</span> sdt<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> g2 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1.2681437731f</span> <span class=\"token operator\">*</span> ldt2 <span class=\"token operator\">+</span> <span class=\"token number\">2.6097574011f</span> <span class=\"token operator\">*</span> mdt2 <span class=\"token operator\">-</span> <span class=\"token number\">0.3413193965f</span> <span class=\"token operator\">*</span> sdt2<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> u_g <span class=\"token operator\">=</span> g1 <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>g1 <span class=\"token operator\">*</span> g1 <span class=\"token operator\">-</span> <span class=\"token number\">0.5f</span> <span class=\"token operator\">*</span> g <span class=\"token operator\">*</span> g2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> t_g <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>g <span class=\"token operator\">*</span> u_g<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> b <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.0041960863f</span> <span class=\"token operator\">*</span> l <span class=\"token operator\">-</span> <span class=\"token number\">0.7034186147f</span> <span class=\"token operator\">*</span> m <span class=\"token operator\">+</span> <span class=\"token number\">1.7076147010f</span> <span class=\"token operator\">*</span> s <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> b1 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.0041960863f</span> <span class=\"token operator\">*</span> ldt <span class=\"token operator\">-</span> <span class=\"token number\">0.7034186147f</span> <span class=\"token operator\">*</span> mdt <span class=\"token operator\">+</span> <span class=\"token number\">1.7076147010f</span> <span class=\"token operator\">*</span> sdt<span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> b2 <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">0.0041960863f</span> <span class=\"token operator\">*</span> ldt2 <span class=\"token operator\">-</span> <span class=\"token number\">0.7034186147f</span> <span class=\"token operator\">*</span> mdt2 <span class=\"token operator\">+</span> <span class=\"token number\">1.7076147010f</span> <span class=\"token operator\">*</span> sdt2<span class=\"token punctuation\">;</span><br><br>\t\t\t\t<span class=\"token keyword\">float</span> u_b <span class=\"token operator\">=</span> b1 <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>b1 <span class=\"token operator\">*</span> b1 <span class=\"token operator\">-</span> <span class=\"token number\">0.5f</span> <span class=\"token operator\">*</span> b <span class=\"token operator\">*</span> b2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t\t\t\t<span class=\"token keyword\">float</span> t_b <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>b <span class=\"token operator\">*</span> u_b<span class=\"token punctuation\">;</span><br><br>\t\t\t\tt_r <span class=\"token operator\">=</span> u_r <span class=\"token operator\">>=</span> <span class=\"token number\">0.f</span> <span class=\"token operator\">?</span> t_r <span class=\"token operator\">:</span> FLT_MAX<span class=\"token punctuation\">;</span><br>\t\t\t\tt_g <span class=\"token operator\">=</span> u_g <span class=\"token operator\">>=</span> <span class=\"token number\">0.f</span> <span class=\"token operator\">?</span> t_g <span class=\"token operator\">:</span> FLT_MAX<span class=\"token punctuation\">;</span><br>\t\t\t\tt_b <span class=\"token operator\">=</span> u_b <span class=\"token operator\">>=</span> <span class=\"token number\">0.f</span> <span class=\"token operator\">?</span> t_b <span class=\"token operator\">:</span> FLT_MAX<span class=\"token punctuation\">;</span><br><br>\t\t\t\tt <span class=\"token operator\">+=</span> <span class=\"token function\">min</span><span class=\"token punctuation\">(</span>t_r<span class=\"token punctuation\">,</span> <span class=\"token function\">min</span><span class=\"token punctuation\">(</span>t_g<span class=\"token punctuation\">,</span> t_b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t\t\t<span class=\"token punctuation\">}</span><br>\t\t<span class=\"token punctuation\">}</span><br>\t<span class=\"token punctuation\">}</span><br><br>\t<span class=\"token keyword\">return</span> t<span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br></code></pre>\n<h4 id=\"gamut-clipping-2\">Gamut clipping <a class=\"anchor-link\" href=\"#gamut-clipping-2\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Implementations of the gamut clipping methods in this article. The code has been written to be easy to follow. Consider optimizing for your use case.</p>\n<pre class=\"language-cpp\"><code class=\"language-cpp\"><br><span class=\"token keyword\">float</span> <span class=\"token function\">clamp</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> x<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> min<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> max<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">&lt;</span> min<span class=\"token punctuation\">)</span><br>\t\t<span class=\"token keyword\">return</span> min<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">></span> max<span class=\"token punctuation\">)</span><br>\t\t<span class=\"token keyword\">return</span> max<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">return</span> x<span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br><span class=\"token keyword\">float</span> <span class=\"token function\">sgn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span> x<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.f</span> <span class=\"token operator\">&lt;</span> x<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">float</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br>RGB <span class=\"token function\">gamut_clip_preserve_chroma</span><span class=\"token punctuation\">(</span>RGB rgb<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><br>\t\t<span class=\"token keyword\">return</span> rgb<span class=\"token punctuation\">;</span><br><br>\tLab lab <span class=\"token operator\">=</span> <span class=\"token function\">linear_srgb_to_oklab</span><span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> L <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> eps <span class=\"token operator\">=</span> <span class=\"token number\">0.00001f</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C <span class=\"token operator\">=</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>eps<span class=\"token punctuation\">,</span> <span class=\"token function\">sqrtf</span><span class=\"token punctuation\">(</span>lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> a_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> b_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> L0 <span class=\"token operator\">=</span> <span class=\"token function\">clamp</span><span class=\"token punctuation\">(</span>L<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> t <span class=\"token operator\">=</span> <span class=\"token function\">find_gamut_intersection</span><span class=\"token punctuation\">(</span>a_<span class=\"token punctuation\">,</span> b_<span class=\"token punctuation\">,</span> L<span class=\"token punctuation\">,</span> C<span class=\"token punctuation\">,</span> L0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> L_clipped <span class=\"token operator\">=</span> L0 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C_clipped <span class=\"token operator\">=</span> t <span class=\"token operator\">*</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">return</span> <span class=\"token function\">oklab_to_linear_srgb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> L_clipped<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> a_<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> b_ <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br>RGB <span class=\"token function\">gamut_clip_project_to_0_5</span><span class=\"token punctuation\">(</span>RGB rgb<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><br>\t\t<span class=\"token keyword\">return</span> rgb<span class=\"token punctuation\">;</span><br><br>\tLab lab <span class=\"token operator\">=</span> <span class=\"token function\">linear_srgb_to_oklab</span><span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> L <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> eps <span class=\"token operator\">=</span> <span class=\"token number\">0.00001f</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C <span class=\"token operator\">=</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>eps<span class=\"token punctuation\">,</span> <span class=\"token function\">sqrtf</span><span class=\"token punctuation\">(</span>lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> a_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> b_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> L0 <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> t <span class=\"token operator\">=</span> <span class=\"token function\">find_gamut_intersection</span><span class=\"token punctuation\">(</span>a_<span class=\"token punctuation\">,</span> b_<span class=\"token punctuation\">,</span> L<span class=\"token punctuation\">,</span> C<span class=\"token punctuation\">,</span> L0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> L_clipped <span class=\"token operator\">=</span> L0 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C_clipped <span class=\"token operator\">=</span> t <span class=\"token operator\">*</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">return</span> <span class=\"token function\">oklab_to_linear_srgb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> L_clipped<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> a_<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> b_ <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br>RGB <span class=\"token function\">gamut_clip_project_to_L_cusp</span><span class=\"token punctuation\">(</span>RGB rgb<span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><br>\t\t<span class=\"token keyword\">return</span> rgb<span class=\"token punctuation\">;</span><br><br>\tLab lab <span class=\"token operator\">=</span> <span class=\"token function\">linear_srgb_to_oklab</span><span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> L <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> eps <span class=\"token operator\">=</span> <span class=\"token number\">0.00001f</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C <span class=\"token operator\">=</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>eps<span class=\"token punctuation\">,</span> <span class=\"token function\">sqrtf</span><span class=\"token punctuation\">(</span>lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> a_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> b_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token comment\">// The cusp is computed here and in find_gamut_intersection, an optimized solution would only compute it once.</span><br>\tLC cusp <span class=\"token operator\">=</span> <span class=\"token function\">find_cusp</span><span class=\"token punctuation\">(</span>a_<span class=\"token punctuation\">,</span> b_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> L0 <span class=\"token operator\">=</span> cusp<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> t <span class=\"token operator\">=</span> <span class=\"token function\">find_gamut_intersection</span><span class=\"token punctuation\">(</span>a_<span class=\"token punctuation\">,</span> b_<span class=\"token punctuation\">,</span> L<span class=\"token punctuation\">,</span> C<span class=\"token punctuation\">,</span> L0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> L_clipped <span class=\"token operator\">=</span> L0 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C_clipped <span class=\"token operator\">=</span> t <span class=\"token operator\">*</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">return</span> <span class=\"token function\">oklab_to_linear_srgb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> L_clipped<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> a_<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> b_ <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br>RGB <span class=\"token function\">gamut_clip_adaptive_L0_0_5</span><span class=\"token punctuation\">(</span>RGB rgb<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> alpha <span class=\"token operator\">=</span> <span class=\"token number\">0.05f</span><span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><br>\t\t<span class=\"token keyword\">return</span> rgb<span class=\"token punctuation\">;</span><br><br>\tLab lab <span class=\"token operator\">=</span> <span class=\"token function\">linear_srgb_to_oklab</span><span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> L <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> eps <span class=\"token operator\">=</span> <span class=\"token number\">0.00001f</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C <span class=\"token operator\">=</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>eps<span class=\"token punctuation\">,</span> <span class=\"token function\">sqrtf</span><span class=\"token punctuation\">(</span>lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> a_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> b_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> Ld <span class=\"token operator\">=</span> L <span class=\"token operator\">-</span> <span class=\"token number\">0.5f</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> e1 <span class=\"token operator\">=</span> <span class=\"token number\">0.5f</span> <span class=\"token operator\">+</span> <span class=\"token function\">fabs</span><span class=\"token punctuation\">(</span>Ld<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> alpha <span class=\"token operator\">*</span> C<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> L0 <span class=\"token operator\">=</span> <span class=\"token number\">0.5f</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token number\">1.f</span> <span class=\"token operator\">+</span> <span class=\"token function\">sgn</span><span class=\"token punctuation\">(</span>Ld<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>e1 <span class=\"token operator\">-</span> <span class=\"token function\">sqrtf</span><span class=\"token punctuation\">(</span>e1<span class=\"token operator\">*</span>e1 <span class=\"token operator\">-</span> <span class=\"token number\">2.f</span> <span class=\"token operator\">*</span><span class=\"token function\">fabs</span><span class=\"token punctuation\">(</span>Ld<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> t <span class=\"token operator\">=</span> <span class=\"token function\">find_gamut_intersection</span><span class=\"token punctuation\">(</span>a_<span class=\"token punctuation\">,</span> b_<span class=\"token punctuation\">,</span> L<span class=\"token punctuation\">,</span> C<span class=\"token punctuation\">,</span> L0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> L_clipped <span class=\"token operator\">=</span> L0 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1.f</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C_clipped <span class=\"token operator\">=</span> t <span class=\"token operator\">*</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">return</span> <span class=\"token function\">oklab_to_linear_srgb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> L_clipped<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> a_<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> b_ <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br>RGB <span class=\"token function\">gamut_clip_adaptive_L0_L_cusp</span><span class=\"token punctuation\">(</span>RGB rgb<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> alpha <span class=\"token operator\">=</span> <span class=\"token number\">0.05f</span><span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">{</span><br>\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">&lt;</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>r <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>g <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">&amp;&amp;</span> rgb<span class=\"token punctuation\">.</span>b <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><br>\t\t<span class=\"token keyword\">return</span> rgb<span class=\"token punctuation\">;</span><br><br>\tLab lab <span class=\"token operator\">=</span> <span class=\"token function\">linear_srgb_to_oklab</span><span class=\"token punctuation\">(</span>rgb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> L <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> eps <span class=\"token operator\">=</span> <span class=\"token number\">0.00001f</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C <span class=\"token operator\">=</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>eps<span class=\"token punctuation\">,</span> <span class=\"token function\">sqrtf</span><span class=\"token punctuation\">(</span>lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">*</span> lab<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> a_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>a <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> b_ <span class=\"token operator\">=</span> lab<span class=\"token punctuation\">.</span>b <span class=\"token operator\">/</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token comment\">// The cusp is computed here and in find_gamut_intersection, an optimized solution would only compute it once.</span><br>\tLC cusp <span class=\"token operator\">=</span> <span class=\"token function\">find_cusp</span><span class=\"token punctuation\">(</span>a_<span class=\"token punctuation\">,</span> b_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> Ld <span class=\"token operator\">=</span> L <span class=\"token operator\">-</span> cusp<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> k <span class=\"token operator\">=</span> <span class=\"token number\">2.f</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>Ld <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token number\">1.f</span> <span class=\"token operator\">-</span> cusp<span class=\"token punctuation\">.</span>L <span class=\"token operator\">:</span> cusp<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> e1 <span class=\"token operator\">=</span> <span class=\"token number\">0.5f</span><span class=\"token operator\">*</span>k <span class=\"token operator\">+</span> <span class=\"token function\">fabs</span><span class=\"token punctuation\">(</span>Ld<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> alpha <span class=\"token operator\">*</span> C<span class=\"token operator\">/</span>k<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> L0 <span class=\"token operator\">=</span> cusp<span class=\"token punctuation\">.</span>L <span class=\"token operator\">+</span> <span class=\"token number\">0.5f</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token function\">sgn</span><span class=\"token punctuation\">(</span>Ld<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>e1 <span class=\"token operator\">-</span> <span class=\"token function\">sqrtf</span><span class=\"token punctuation\">(</span>e1 <span class=\"token operator\">*</span> e1 <span class=\"token operator\">-</span> <span class=\"token number\">2.f</span> <span class=\"token operator\">*</span> k <span class=\"token operator\">*</span> <span class=\"token function\">fabs</span><span class=\"token punctuation\">(</span>Ld<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">float</span> t <span class=\"token operator\">=</span> <span class=\"token function\">find_gamut_intersection</span><span class=\"token punctuation\">(</span>a_<span class=\"token punctuation\">,</span> b_<span class=\"token punctuation\">,</span> L<span class=\"token punctuation\">,</span> C<span class=\"token punctuation\">,</span> L0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> L_clipped <span class=\"token operator\">=</span> L0 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1.f</span> <span class=\"token operator\">-</span> t<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> L<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> C_clipped <span class=\"token operator\">=</span> t <span class=\"token operator\">*</span> C<span class=\"token punctuation\">;</span><br><br>\t<span class=\"token keyword\">return</span> <span class=\"token function\">oklab_to_linear_srgb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> L_clipped<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> a_<span class=\"token punctuation\">,</span> C_clipped <span class=\"token operator\">*</span> b_ <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br></code></pre>\n",
      "date_published": "2021-01-25T01:00:00+01:00"
    },{
      "id": "https://bottosson.github.io/posts/oklab/",
      "url": "https://bottosson.github.io/posts/oklab/",
      "title": "A perceptual color space for image processing",
      "content_html": "<h1 id=\"a-perceptual-color-space-for-image-processing\">A perceptual color space for image processing <a class=\"anchor-link\" href=\"#a-perceptual-color-space-for-image-processing\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h1>\n<p>A perceptual color space is desirable when doing many kinds of image processing. It is useful for things like:</p>\n<ul>\n<li>Turning an image grayscale, while keeping the perceived lightness the same</li>\n<li>Increasing the saturation of colors, while maintaining perceived hue and lightness</li>\n<li>Creating smooth and uniform looking transitions between colors</li>\n</ul>\n<p>Unfortunately, as far as I am aware, while there are color spaces that aim to be perceptually uniform, none are without significant drawbacks when used for image processing.</p>\n<p>For this reason I have designed a new perceptual color space, designed to be simple to use, while doing a good job at predicting perceived lightness, <a href=\"https://en.wikipedia.org/wiki/Colorfulness\">chroma</a> and hue. It is called the <strong>Oklab color space</strong>, because it is an OK Lab color space.</p>\n<p>Before diving into the details of why a new color space is needed and how it was derived, here is the everything needed to use the color space:</p>\n<blockquote>\n<h5 id=\"oklab-implementations\">Oklab implementations <a class=\"anchor-link\" href=\"#oklab-implementations\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h5>\n<p>Here is a list of Oklab implementations that I am aware of. The list will be updated as I’m made aware of more implementation. These are all implemented by other people and I have not verified their correctness myself.</p>\n<ul>\n<li>Python – <a href=\"https://github.com/colour-science/colour\"><strong>Colour</strong></a>, <a href=\"https://github.com/nschloe/colorio\"><strong>colorio</strong></a></li>\n<li>Javascript – <a href=\"https://github.com/Evercoder/culori\"><strong>culori</strong></a></li>\n<li>TypeScript – <a href=\"https://github.com/thi-ng/umbrella/tree/develop/packages/color\"><strong>thi.ng/color</strong></a></li>\n<li>C++ – <a href=\"https://github.com/thomasp85/farver\"><strong>farver</strong></a></li>\n<li>Matlab – <a href=\"https://github.com/alecjacobson/gptoolbox\"><strong>Geometry Processing Toolbox</strong></a></li>\n<li>Java – <a href=\"https://github.com/tommyettinger/colorful-gdx\"><strong>colorful-gdx</strong></a></li>\n<li>Various – <a href=\"https://gmic.eu/\"><strong>G’MIC</strong></a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Nuke_(software)\">Nuke</a> – <a href=\"https://github.com/jedypod/nuke-colortools\"><strong>Nuke Color Tools</strong></a></li>\n</ul>\n<p>There are also a few experiments available to play around with Oklab online at <a href=\"https://observablehq.com/search?query=oklab\"><strong>Observable</strong></a> and <a href=\"https://www.shadertoy.com/results?query=oklab\"><strong>Shadertoy</strong></a></p>\n</blockquote>\n<h1 id=\"the-oklab-color-space\">The Oklab color space <a class=\"anchor-link\" href=\"#the-oklab-color-space\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h1>\n<p>A color in Oklab is represented with three coordinates, similar to how <a href=\"https://en.wikipedia.org/wiki/CIELAB_color_space\">CIELAB</a> works, but with better perceptual properties. Oklab uses a D65 whitepoint, since this is what sRGB and other common color spaces use. The three coordinates are:</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span></span> – perceived lightness</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">a</span></span></span></span> – how green/red the color is</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">b</span></span></span></span> – how blue/yellow the color is</li>\n</ul>\n<p>For many operations, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">Lab</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">b</span></span></span></span>-coordinates can be used directly, but they can also be transformed into polar form, with the coordinates lightness, chroma and hue, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mi>C</mi><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">LCh</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathit\">h</span></span></span></span>:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi><mo>=</mo><mrow><msqrt><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup></mrow></msqrt></mrow><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mtext><mi mathvariant=\"normal\">a</mi><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">a</mi><mi mathvariant=\"normal\">n</mi><mn>2</mn></mtext><mo>(</mo><mi>b</mi><mo separator=\"true\">,</mo><mi>a</mi><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">C={\\sqrt {a^2+b^2}}, \\qquad h^{\\circ}=\\text{atan2}(b,a) \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:1.0622690000000001em;\"></span><span class=\"strut bottom\" style=\"height:1.3122690000000001em;vertical-align:-0.25em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"mrel\">=</span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"sqrt mord\"><span class=\"sqrt-sign\" style=\"top:-0.17226900000000012em;\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing size1\">√</span></span></span><span class=\"vlist\"><span style=\"top:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"mord displaystyle textstyle cramped\"><span class=\"mord\"><span class=\"mord mathit\">a</span><span class=\"vlist\"><span style=\"top:-0.289em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">+</span><span class=\"mord\"><span class=\"mord mathit\">b</span><span class=\"vlist\"><span style=\"top:-0.289em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathrm\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:-0.9822690000000001em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span><span class=\"reset-textstyle textstyle uncramped sqrt-line\"></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:1em;\">​</span></span>​</span></span></span></span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mrel\">=</span><span class=\"text mord displaystyle textstyle uncramped\"><span class=\"mord mathrm\">a</span><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">a</span><span class=\"mord mathrm\">n</span><span class=\"mord mathrm\">2</span></span><span class=\"mopen\">(</span><span class=\"mord mathit\">b</span><span class=\"mpunct\">,</span><span class=\"mord mathit\">a</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>From <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding=\"application/x-tex\">h^{\\circ}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">a</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">b</span></span></span></span> can be computed like this:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi><mo>=</mo><mi>C</mi><mi>cos</mi><mo>(</mo><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>)</mo><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><mi>b</mi><mo>=</mo><mi>C</mi><mi>sin</mi><mo>(</mo><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>)</mo></mrow><annotation encoding=\"application/x-tex\">a=C\\cos(h^{\\circ}),\\qquad b=C\\sin(h^{\\circ}) \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord mathit\">a</span><span class=\"mrel\">=</span><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"mop\">cos</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"mord mathit\">b</span><span class=\"mrel\">=</span><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span><span class=\"mop\">sin</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">h</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">∘</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>Lets look at a practical example to see how Oklab performs, before looking at how the <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">Lab</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">b</span></span></span></span> coordinates are computed.</p>\n<blockquote>\n<h4 id=\"comparing-oklab-to-hsv\">Comparing Oklab to HSV <a class=\"anchor-link\" href=\"#comparing-oklab-to-hsv\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Here’s an Oklab color gradient with varying hue and constant lightness and chroma.</p>\n<p><img src=\"/img/oklab/hue_oklab.png\" alt=\"Oklab varying hue plot\"></p>\n<p>Compare this to a similar plot of a HSV color gradient with varying hue and constant value and saturation (HSV using the sRGB color space).</p>\n<p><img src=\"/img/oklab/hue_hsv.png\" alt=\"HSV varying hue plot\"></p>\n<p>The gradient is quite uneven and there are clear differences in lightness for different hues. Yellow, magenta and cyan appear much lighter than red and blue.</p>\n<p>Here is lightness of the HSV plot, as predicted by Oklab:</p>\n<p><img src=\"/img/oklab/hue_hsv_lightness.png\" alt=\"HSV varying hue plot lightness\"></p>\n</blockquote>\n<h3 id=\"implementation\">Implementation <a class=\"anchor-link\" href=\"#implementation\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<h4 id=\"converting-from-xyz-to-oklab\">Converting from XYZ to Oklab <a class=\"anchor-link\" href=\"#converting-from-xyz-to-oklab\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Given a color in <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>X</mi><mi>Y</mi><mi>Z</mi></mrow><annotation encoding=\"application/x-tex\">XYZ</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord mathit\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">Z</span></span></span></span> coordinates, with a D65 whitepoint and white as Y=1, Oklab coordinates can be computed like this:</p>\n<p>First the <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>X</mi><mi>Y</mi><mi>Z</mi></mrow><annotation encoding=\"application/x-tex\">XYZ</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord mathit\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">Z</span></span></span></span> coordinates are converted to an approximate cone responses:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">1</mn></msub></mrow><mo>×</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix} l \\\\ m \\\\ s \\end{pmatrix} = \\mathbf{M_1} \\times \\begin{pmatrix} X \\\\ Y \\\\ Z \\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.05002em;\"></span><span class=\"strut bottom\" style=\"height:3.60004em;vertical-align:-1.55002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">m</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">s</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mbin\">×</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">X</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.22222em;\">Y</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">Z</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<p>A non-linearity is applied:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow></msup></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix} l&#x27; \\\\ m&#x27; \\\\ s&#x27; \\end{pmatrix} = \\begin{pmatrix} l^{\\frac 1 3} \\\\ m^{\\frac 1 3} \\\\ s^{\\frac 1 3} \\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.3500249999999996em;\"></span><span class=\"strut bottom\" style=\"height:4.200049999999999em;vertical-align:-1.850025em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">m</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">s</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:1.2050049999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:0.049995000000000074em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎜</span></span></span><span style=\"top:-1.1950249999999998em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.29551em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord reset-scriptstyle scriptstyle uncramped\"><span class=\"sizing reset-size5 size5 reset-scriptstyle textstyle uncramped nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist\"><span style=\"top:0.345em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-scriptstyle scriptscriptstyle cramped\"><span class=\"mord mathrm\">3</span></span></span><span style=\"top:-0.22142857142857142em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-scriptstyle textstyle uncramped frac-line\"></span></span><span style=\"top:-0.394em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-scriptstyle scriptscriptstyle uncramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"sizing reset-size5 size5 reset-scriptstyle textstyle uncramped nulldelimiter\"></span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:0.07551000000000024em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">m</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord reset-scriptstyle scriptstyle uncramped\"><span class=\"sizing reset-size5 size5 reset-scriptstyle textstyle uncramped nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist\"><span style=\"top:0.345em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-scriptstyle scriptscriptstyle cramped\"><span class=\"mord mathrm\">3</span></span></span><span style=\"top:-0.22142857142857142em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-scriptstyle textstyle uncramped frac-line\"></span></span><span style=\"top:-0.394em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-scriptstyle scriptscriptstyle uncramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"sizing reset-size5 size5 reset-scriptstyle textstyle uncramped nulldelimiter\"></span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:1.4465299999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">s</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord reset-scriptstyle scriptstyle uncramped\"><span class=\"sizing reset-size5 size5 reset-scriptstyle textstyle uncramped nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist\"><span style=\"top:0.345em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-scriptstyle scriptscriptstyle cramped\"><span class=\"mord mathrm\">3</span></span></span><span style=\"top:-0.22142857142857142em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-scriptstyle textstyle uncramped frac-line\"></span></span><span style=\"top:-0.394em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-scriptstyle scriptscriptstyle uncramped\"><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"sizing reset-size5 size5 reset-scriptstyle textstyle uncramped nulldelimiter\"></span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:1.2050049999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:0.049995000000000074em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎟</span></span></span><span style=\"top:-1.1950249999999998em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<p>Finally, this is transformed into the <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">Lab</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\">b</span></span></span></span>-coordinates:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">2</mn></msub></mrow><mo>×</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix} L \\\\ a \\\\ b \\end{pmatrix} = \\mathbf{M_2} \\times \\begin{pmatrix} l&#x27; \\\\ m&#x27; \\\\ s&#x27; \\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.05002em;\"></span><span class=\"strut bottom\" style=\"height:3.60004em;vertical-align:-1.55002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">a</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">b</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mbin\">×</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">m</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">s</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<p>with the following values for <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">1</mn></msub></mrow></mrow><annotation encoding=\"application/x-tex\">\\mathbf{M_1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68611em;\"></span><span class=\"strut bottom\" style=\"height:0.83611em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">2</mn></msub></mrow></mrow><annotation encoding=\"application/x-tex\">\\mathbf{M_2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68611em;\"></span><span class=\"strut bottom\" style=\"height:0.83611em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span>:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">1</mn></msub></mrow><mo>=</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>8</mn><mn>1</mn><mn>8</mn><mn>9</mn><mn>3</mn><mn>3</mn><mn>0</mn><mn>1</mn><mn>0</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>3</mn><mn>6</mn><mn>1</mn><mn>8</mn><mn>6</mn><mn>6</mn><mn>7</mn><mn>4</mn><mn>2</mn><mn>4</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>1</mn><mn>2</mn><mn>8</mn><mn>8</mn><mn>5</mn><mn>9</mn><mn>7</mn><mn>1</mn><mn>3</mn><mn>7</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>3</mn><mn>2</mn><mn>9</mn><mn>8</mn><mn>4</mn><mn>5</mn><mn>4</mn><mn>3</mn><mn>6</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>9</mn><mn>2</mn><mn>9</mn><mn>3</mn><mn>1</mn><mn>1</mn><mn>8</mn><mn>7</mn><mn>1</mn><mn>5</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>3</mn><mn>6</mn><mn>1</mn><mn>4</mn><mn>5</mn><mn>6</mn><mn>3</mn><mn>8</mn><mn>7</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>4</mn><mn>8</mn><mn>2</mn><mn>0</mn><mn>0</mn><mn>3</mn><mn>0</mn><mn>1</mn><mn>8</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>2</mn><mn>6</mn><mn>4</mn><mn>3</mn><mn>6</mn><mn>6</mn><mn>2</mn><mn>6</mn><mn>9</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>6</mn><mn>3</mn><mn>3</mn><mn>8</mn><mn>5</mn><mn>1</mn><mn>7</mn><mn>0</mn><mn>7</mn><mn>0</mn></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\mathbf{M_1} = \\begin{pmatrix} +0.8189330101 &amp; +0.3618667424 &amp; -0.1288597137 \\\\ +0.0329845436 &amp; +0.9293118715 &amp; +0.0361456387 \\\\ +0.0482003018 &amp; +0.2643662691 &amp; +0.6338517070 \\end{pmatrix} \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.05002em;\"></span><span class=\"strut bottom\" style=\"height:3.60004em;vertical-align:-1.55002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mrel\">=</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">1</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">6</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">8</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">4</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">5</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">−</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">7</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">7</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">2</mn></msub></mrow><mo>=</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>2</mn><mn>1</mn><mn>0</mn><mn>4</mn><mn>5</mn><mn>4</mn><mn>2</mn><mn>5</mn><mn>5</mn><mn>3</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>7</mn><mn>9</mn><mn>3</mn><mn>6</mn><mn>1</mn><mn>7</mn><mn>7</mn><mn>8</mn><mn>5</mn><mn>0</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>0</mn><mn>4</mn><mn>0</mn><mn>7</mn><mn>2</mn><mn>0</mn><mn>4</mn><mn>6</mn><mn>8</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>1</mn><mi mathvariant=\"normal\">.</mi><mn>9</mn><mn>7</mn><mn>7</mn><mn>9</mn><mn>9</mn><mn>8</mn><mn>4</mn><mn>9</mn><mn>5</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>2</mn><mi mathvariant=\"normal\">.</mi><mn>4</mn><mn>2</mn><mn>8</mn><mn>5</mn><mn>9</mn><mn>2</mn><mn>2</mn><mn>0</mn><mn>5</mn><mn>0</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>4</mn><mn>5</mn><mn>0</mn><mn>5</mn><mn>9</mn><mn>3</mn><mn>7</mn><mn>0</mn><mn>9</mn><mn>9</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>0</mn><mn>2</mn><mn>5</mn><mn>9</mn><mn>0</mn><mn>4</mn><mn>0</mn><mn>3</mn><mn>7</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>7</mn><mn>8</mn><mn>2</mn><mn>7</mn><mn>7</mn><mn>1</mn><mn>7</mn><mn>6</mn><mn>6</mn><mn>2</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>0</mn><mi mathvariant=\"normal\">.</mi><mn>8</mn><mn>0</mn><mn>8</mn><mn>6</mn><mn>7</mn><mn>5</mn><mn>7</mn><mn>6</mn><mn>6</mn><mn>0</mn></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\mathbf{M_2} = \\begin{pmatrix} +0.2104542553 &amp; +0.7936177850 &amp; -0.0040720468 \\\\ +1.9779984951 &amp; -2.4285922050 &amp; +0.4505937099 \\\\ +0.0259040371 &amp; +0.7827717662 &amp; -0.8086757660 \\end{pmatrix} \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.05002em;\"></span><span class=\"strut bottom\" style=\"height:3.60004em;vertical-align:-1.55002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mrel\">=</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">3</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">1</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">−</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">−</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">8</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">+</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">4</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">3</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">9</span><span class=\"mord mathrm\">9</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\">−</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">0</span><span class=\"mord mathrm\">8</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">5</span><span class=\"mord mathrm\">7</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">6</span><span class=\"mord mathrm\">0</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<p>The inverse operation, going from Oklab to XYZ is done with the following steps:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><msup><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">2</mn></msub></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>×</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>l</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>m</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>s</mi><mrow><mi mathvariant=\"normal\">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo separator=\"true\">,</mo><mspace width=\"2em\"></mspace><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><msup><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">1</mn></msub></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>×</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix} l&#x27; \\\\ m&#x27; \\\\ s&#x27; \\end{pmatrix} = \\mathbf{M_2}^{-1} \\times \\begin{pmatrix} L \\\\ a \\\\ b \\end{pmatrix},\\qquad \n\\begin{pmatrix} l \\\\ m \\\\ s \\end{pmatrix} = \\begin{pmatrix} {(l&#x27;)}^{3} \\\\ {(m&#x27;)}^{3} \\\\ {(s&#x27;)}^{3} \\end{pmatrix},\\qquad \n\\begin{pmatrix} X \\\\ Y \\\\ Z \\end{pmatrix} = \\mathbf{M_1}^{-1} \\times \\begin{pmatrix} l \\\\ m \\\\ s \\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.0905em;\"></span><span class=\"strut bottom\" style=\"height:3.681em;vertical-align:-1.5905000000000002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">m</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">s</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"vlist\"><span style=\"top:-0.41300000000000003em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">−</span><span class=\"mord mathrm\">1</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">×</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">a</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">b</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">m</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">s</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2235em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span><span class=\"vlist\"><span style=\"top:-0.41589200000000004em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">3</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:0.0035000000000005582em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">m</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span><span class=\"vlist\"><span style=\"top:-0.41589200000000004em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">3</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:1.2305000000000001em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">s</span><span class=\"vlist\"><span style=\"top:-0.413em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">′</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span><span class=\"vlist\"><span style=\"top:-0.41589200000000004em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord mathrm\">3</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mord mspace qquad\"></span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">X</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.22222em;\">Y</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">Z</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"\"><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"vlist\"><span style=\"top:-0.41300000000000003em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord scriptstyle uncramped\"><span class=\"mord\">−</span><span class=\"mord mathrm\">1</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mbin\">×</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">m</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">s</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<br/>\n<blockquote>\n<h5 id=\"table-of-example-xyz-and-oklab-pairs\">Table of example XYZ and Oklab pairs <a class=\"anchor-link\" href=\"#table-of-example-xyz-and-oklab-pairs\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h5>\n<p>Provided to test Oklab implementations. Computed by transforming the XYZ coordinates to Oklab and rounding to three decimals.</p>\n<table>\n<thead>\n<tr>\n<th>X</th>\n<th>Y</th>\n<th>Z</th>\n<th>L</th>\n<th>a</th>\n<th>b</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>0.950</td>\n<td>1.000</td>\n<td>1.089</td>\n<td>1.000</td>\n<td>0.000</td>\n<td>0.000</td>\n</tr>\n<tr>\n<td>1.000</td>\n<td>0.000</td>\n<td>0.000</td>\n<td>0.450</td>\n<td>1.236</td>\n<td>-0.019</td>\n</tr>\n<tr>\n<td>0.000</td>\n<td>1.000</td>\n<td>0.000</td>\n<td>0.922</td>\n<td>-0.671</td>\n<td>0.263</td>\n</tr>\n<tr>\n<td>0.000</td>\n<td>0.000</td>\n<td>1.000</td>\n<td>0.153</td>\n<td>-1.415</td>\n<td>-0.449</td>\n</tr>\n</tbody>\n</table>\n</blockquote>\n<br/>\n<h4 id=\"converting-from-linear-srgb-to-oklab\">Converting from linear sRGB to Oklab <a class=\"anchor-link\" href=\"#converting-from-linear-srgb-to-oklab\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Since this will be a common use case, here is the code to convert linear sRGB values to Oklab and back. To compute linear sRGB values, see <a href=\"https://bottosson.github.io/posts/colorwrong/#what-can-we-do%3F\">my previous post</a>.</p>\n<p>The code is in C++, but without any fancy features so should be easy to translate. The code is available in public domain, feel free to use it any way you please. It is also available under an MIT licensee if you for some reason can’t or don’t want to use public domain software. The license text <a href=\"https://bottosson.github.io/misc/License.txt\">is available here</a></p>\n<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">struct</span> <span class=\"token class-name\">Lab</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">float</span> L<span class=\"token punctuation\">;</span> <span class=\"token keyword\">float</span> a<span class=\"token punctuation\">;</span> <span class=\"token keyword\">float</span> b<span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">struct</span> <span class=\"token class-name\">RGB</span> <span class=\"token punctuation\">{</span><span class=\"token keyword\">float</span> r<span class=\"token punctuation\">;</span> <span class=\"token keyword\">float</span> g<span class=\"token punctuation\">;</span> <span class=\"token keyword\">float</span> b<span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br><br>Lab <span class=\"token function\">linear_srgb_to_oklab</span><span class=\"token punctuation\">(</span>RGB c<span class=\"token punctuation\">)</span> <br><span class=\"token punctuation\">{</span><br>    <span class=\"token keyword\">float</span> l <span class=\"token operator\">=</span> <span class=\"token number\">0.4122214708f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>r <span class=\"token operator\">+</span> <span class=\"token number\">0.5363325363f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>g <span class=\"token operator\">+</span> <span class=\"token number\">0.0514459929f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> m <span class=\"token operator\">=</span> <span class=\"token number\">0.2119034982f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>r <span class=\"token operator\">+</span> <span class=\"token number\">0.6806995451f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>g <span class=\"token operator\">+</span> <span class=\"token number\">0.1073969566f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br>\t<span class=\"token keyword\">float</span> s <span class=\"token operator\">=</span> <span class=\"token number\">0.0883024619f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>r <span class=\"token operator\">+</span> <span class=\"token number\">0.2817188376f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>g <span class=\"token operator\">+</span> <span class=\"token number\">0.6299787005f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br><br>    <span class=\"token keyword\">float</span> l_ <span class=\"token operator\">=</span> <span class=\"token function\">cbrtf</span><span class=\"token punctuation\">(</span>l<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> m_ <span class=\"token operator\">=</span> <span class=\"token function\">cbrtf</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> s_ <span class=\"token operator\">=</span> <span class=\"token function\">cbrtf</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><br>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><br>        <span class=\"token number\">0.2104542553f</span><span class=\"token operator\">*</span>l_ <span class=\"token operator\">+</span> <span class=\"token number\">0.7936177850f</span><span class=\"token operator\">*</span>m_ <span class=\"token operator\">-</span> <span class=\"token number\">0.0040720468f</span><span class=\"token operator\">*</span>s_<span class=\"token punctuation\">,</span><br>        <span class=\"token number\">1.9779984951f</span><span class=\"token operator\">*</span>l_ <span class=\"token operator\">-</span> <span class=\"token number\">2.4285922050f</span><span class=\"token operator\">*</span>m_ <span class=\"token operator\">+</span> <span class=\"token number\">0.4505937099f</span><span class=\"token operator\">*</span>s_<span class=\"token punctuation\">,</span><br>        <span class=\"token number\">0.0259040371f</span><span class=\"token operator\">*</span>l_ <span class=\"token operator\">+</span> <span class=\"token number\">0.7827717662f</span><span class=\"token operator\">*</span>m_ <span class=\"token operator\">-</span> <span class=\"token number\">0.8086757660f</span><span class=\"token operator\">*</span>s_<span class=\"token punctuation\">,</span><br>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span><br><br>RGB <span class=\"token function\">oklab_to_linear_srgb</span><span class=\"token punctuation\">(</span>Lab c<span class=\"token punctuation\">)</span> <br><span class=\"token punctuation\">{</span><br>    <span class=\"token keyword\">float</span> l_ <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span>L <span class=\"token operator\">+</span> <span class=\"token number\">0.3963377774f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>a <span class=\"token operator\">+</span> <span class=\"token number\">0.2158037573f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> m_ <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span>L <span class=\"token operator\">-</span> <span class=\"token number\">0.1055613458f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>a <span class=\"token operator\">-</span> <span class=\"token number\">0.0638541728f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> s_ <span class=\"token operator\">=</span> c<span class=\"token punctuation\">.</span>L <span class=\"token operator\">-</span> <span class=\"token number\">0.0894841775f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>a <span class=\"token operator\">-</span> <span class=\"token number\">1.2914855480f</span> <span class=\"token operator\">*</span> c<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">;</span><br><br>    <span class=\"token keyword\">float</span> l <span class=\"token operator\">=</span> l_<span class=\"token operator\">*</span>l_<span class=\"token operator\">*</span>l_<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> m <span class=\"token operator\">=</span> m_<span class=\"token operator\">*</span>m_<span class=\"token operator\">*</span>m_<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">float</span> s <span class=\"token operator\">=</span> s_<span class=\"token operator\">*</span>s_<span class=\"token operator\">*</span>s_<span class=\"token punctuation\">;</span><br><br>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><br>\t\t<span class=\"token operator\">+</span><span class=\"token number\">4.0767416621f</span> <span class=\"token operator\">*</span> l <span class=\"token operator\">-</span> <span class=\"token number\">3.3077115913f</span> <span class=\"token operator\">*</span> m <span class=\"token operator\">+</span> <span class=\"token number\">0.2309699292f</span> <span class=\"token operator\">*</span> s<span class=\"token punctuation\">,</span><br>\t\t<span class=\"token operator\">-</span><span class=\"token number\">1.2684380046f</span> <span class=\"token operator\">*</span> l <span class=\"token operator\">+</span> <span class=\"token number\">2.6097574011f</span> <span class=\"token operator\">*</span> m <span class=\"token operator\">-</span> <span class=\"token number\">0.3413193965f</span> <span class=\"token operator\">*</span> s<span class=\"token punctuation\">,</span><br>\t\t<span class=\"token operator\">-</span><span class=\"token number\">0.0041960863f</span> <span class=\"token operator\">*</span> l <span class=\"token operator\">-</span> <span class=\"token number\">0.7034186147f</span> <span class=\"token operator\">*</span> m <span class=\"token operator\">+</span> <span class=\"token number\">1.7076147010f</span> <span class=\"token operator\">*</span> s<span class=\"token punctuation\">,</span><br>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><br><span class=\"token punctuation\">}</span></code></pre>\n<blockquote>\n<p>The matrices were updated 2021-01-25. The new matrices have been derived using a higher precision sRGB matrix and with exactly matching D65 values. The old matrices are available <a href=\"https://bottosson.github.io/misc/License.txt\">here</a> for reference. The values only differ after the first three decimals.</p>\n<p>Depending on use case you might want to use the sRGB matrices your application uses directly instead of the ones provided here.</p>\n</blockquote>\n<p>This is everything you need to use the Oklab color space! If you need a simple perceptual color space, try it out.</p>\n<p>The rest of the post will go into why a new color space was needed, how it has been constructed and how it compares with existing color spaces.</p>\n<hr>\n<h1 id=\"motivation-and-derivation-of-oklab\">Motivation and derivation of Oklab <a class=\"anchor-link\" href=\"#motivation-and-derivation-of-oklab\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h1>\n<p>What properties does a perceptual color space need to satisfy to be useful for image processing? The answer to this is always going to be a bit subjective, but based on my experience, these are a good set of requirements:</p>\n<blockquote>\n<ul>\n<li><strong>Should be an opponent color space</strong>, similar to for example <a href=\"https://en.wikipedia.org/wiki/CIELAB_color_space\">CIELAB</a>.</li>\n<li><strong>Should predict lightness, chroma and hue well</strong>. <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">h</span></span></span></span> should be perceived as orthogonal, so one can be altered without affecting the other two. This is useful for things like turning an image black and white and increasing colorfulness without introducing hue shifts etc.</li>\n<li><strong>Blending two colors should result in even transitions</strong>. The transition colors should appear to be in between the blended colors (e.g. passing through a warmer color than either original color is not good).</li>\n<li><strong>Should assume a D65 whitepoint</strong>. This is what common color spaces like sRGB, rec2020 and Display P3 uses.</li>\n<li><strong>Should behave well numerically</strong>. The model should be easy to compute, numerically stable and differentiable.</li>\n<li><strong>Should assume normal well lit viewing conditions</strong>. The complexity of supporting different viewing conditions is not practical in most applications. Information about absolute luminance and background luminance adaptation does not normally exist and the viewing conditions can vary.</li>\n<li><strong>If the scale/exposure of colors are changed, the perceptual coordinates should just be scaled by a factor</strong>. To handle a large dynamic range without requiring knowledge of viewing conditions all colors should be modelled as if viewed under normal viewing conditions and as if the eye is adapted to roughly the luminance of the color. This avoids a dependence on scaling.</li>\n</ul>\n</blockquote>\n<h3 id=\"what-about-existing-models%3F\">What about existing models? <a class=\"anchor-link\" href=\"#what-about-existing-models%3F\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p>Let’s look at existing models and how they stack up against these requirements. Further down there are graphs that illustrate some of these issues.</p>\n<blockquote>\n<ul>\n<li><strong><a href=\"https://en.wikipedia.org/wiki/CIELAB_color_space\">CIELAB</a> and <a href=\"https://en.wikipedia.org/wiki/CIELUV\">CIELUV</a></strong> –  Largest issue is their inability to predict hue. In particular blue hues are predicted badly. Other smaller issues exist as well</li>\n<li><strong><a href=\"https://en.wikipedia.org/wiki/CIECAM02\">CIECAM02-UCS</a> and the newer CAM16-UCS</strong> – Does a good job at being perceptually uniform overall, but doesn’t meet other requirements: Bad numerical behavior, it is not scale invariant and blending does not behave well because of its compression of chroma. Hue uniformity is decent, but other models predict it more accurately.</li>\n<li><strong><a href=\"https://en.wikipedia.org/wiki/OSA-UCS\">OSA-UCS</a></strong> – Overall does a good job. The transformation to OSA-UCS lacks an analytical inverse unfortunately which makes it impractical.</li>\n<li><strong><a href=\"https://scholarworks.rit.edu/theses/2858/\">IPT</a></strong> – Does a great job modelling hue uniformity. Doesn’t predict lightness and chroma well unfortunately, but meets all other requirements. Is simple computationally and does not depend on the scale/exposure.</li>\n<li><strong><a href=\"https://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&amp;id=368272\">JzAzBz</a></strong> – Overall does a fairly good job. Designed to have uniform scaling of lightness for HDR data. While useful in some cases this introduces a dependence on the scale/exposure that makes it hard to use in general cases.</li>\n<li><strong><a href=\"https://en.wikipedia.org/wiki/HSL_and_HSV\">HSV</a> representation of sRGB</strong> – Only on this list because it is widely used. Does not meet any of the requirements except having a D65 whitepoint.</li>\n</ul>\n</blockquote>\n<p>So, all in all, all these existing models have drawbacks.</p>\n<p>Out of all of these, two models stand out: CAM16-UCS, for being the model with best properties of perceptual uniformity overall, and IPT for having a simple computational structure that meets all the requirements besides predicting lightness and chroma well.</p>\n<p>For this reason it is reasonable to try to make a new color space, with the same computational structure as IPT, but that performs closer to CAM16-UCS in terms of predicting lightness and chroma. This exploration resulted in Oklab.</p>\n<h3 id=\"how-oklab-was-derived\">How Oklab was derived <a class=\"anchor-link\" href=\"#how-oklab-was-derived\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p>To derive Oklab, three datasets were used:</p>\n<ul>\n<li>A generated data set of pairs of colors with the same lightness but random hue and chroma, generated using CAM16 and normal viewing conditions. Colors were limited to be within Pointer’s Gamut – the set of possible surface colors.</li>\n<li>A generated data set of pairs of colors with the same chroma but random hue and lightness, generated using CAM16 and normal viewing conditions. Colors were limited to be within Pointer’s Gamut</li>\n<li>The <a href=\"https://github.com/nschloe/colorio/blob/master/colorio/data/ebner_fairchild.yaml\">uniform perceived hue</a> data used to derive IPT. From this data, colors were combined into pairs of colors with equal perceived hue.</li>\n</ul>\n<p>These datasets can be used to test prediction of lightness, chroma and hue respectively. If a color space accurately models <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">h</span></span></span></span>, then all pairs in lightness dataset should have the same value for <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span></span>, all pairs in the chroma dataset the same value for <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span></span></span></span> and all pairs in the hue dataset the same values for <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">h</span></span></span></span>.</p>\n<p>To test a color space it is not possible to simply check the distance in predictions in the tested color space however, since that will depend on the scaling of the color space. It is also not desirable to exactly predict ground truth values for <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding=\"application/x-tex\">L</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span></span>, <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">C</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">h</span></span></span></span>, since it is more important that our model has perceptually orthogonal coordinates, than that the model has the same spacing within each coordinate.</p>\n<p>Instead the following approach was used to create an error metric independent of the color space:</p>\n<ul>\n<li>For each dataset all the pairs are converted to the tested color space.</li>\n<li>Coordinates that are supposed to be the same within a pair are swapped to generate a new set of altered pairs:\n<ul>\n<li>For the lightness dataset, the L coordinates are swapped between the pairs, and so on.</li>\n<li>These altered pair would be equal to the original pair if the model predicts the datasets perfectly.</li>\n</ul>\n</li>\n<li>The perceived distance between the original colors and the altered colors are are computed using <a href=\"https://en.wikipedia.org/wiki/Color_difference\">CIEDE2000</a>.</li>\n<li>The error for each pair is given as the minimum of the two color differences.</li>\n<li>The error for the entire dataset is the root mean squared error of the color differences.</li>\n</ul>\n<p>Oklab was derived by optimizing the parameters of a color space with the same structure as IPT, to get a low error on all the datasets. For completeness, here is the structure of the color space – the parameters to optimize are the 3x3 matrices <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">1</mn></msub></mrow></mrow><annotation encoding=\"application/x-tex\">\\mathbf{M_1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68611em;\"></span><span class=\"strut bottom\" style=\"height:0.83611em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">2</mn></msub></mrow></mrow><annotation encoding=\"application/x-tex\">\\mathbf{M_2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68611em;\"></span><span class=\"strut bottom\" style=\"height:0.83611em;vertical-align:-0.15em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span> and the positive number <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05556em;\">γ</span></span></span></span>.</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">1</mn></msub></mrow><mo>×</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix} l \\\\ m \\\\ s \\end{pmatrix} = \\mathbf{M_1} \\times \\begin{pmatrix} X \\\\ Y \\\\ Z \\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.05002em;\"></span><span class=\"strut bottom\" style=\"height:3.60004em;vertical-align:-1.55002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">m</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">s</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">1</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mbin\">×</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">X</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.22222em;\">Y</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">Z</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant=\"bold\">M</mi><mn mathvariant=\"bold\">2</mn></msub></mrow><mo>×</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mi>γ</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mi>γ</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mi>γ</mi></msup></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix} L \\\\ a \\\\ b \\end{pmatrix} = \\mathbf{M_2} \\times \\begin{pmatrix} l^\\gamma \\\\ m^\\gamma \\\\ s^\\gamma \\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.05002em;\"></span><span class=\"strut bottom\" style=\"height:3.60004em;vertical-align:-1.55002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">L</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">a</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">b</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathbf\">M</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord mathbf\">2</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mbin\">×</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"vlist\"><span style=\"top:-0.41300000000000003em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05556em;\">γ</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">m</span><span class=\"vlist\"><span style=\"top:-0.41300000000000003em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05556em;\">γ</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">s</span><span class=\"vlist\"><span style=\"top:-0.41300000000000003em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05556em;\">γ</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<p>A couple of extra constraints were also added, since this error doesn’t alone determine the scale and orientation of the color model.</p>\n<ul>\n<li>Positive b is oriented to the same yellow color as CAM16</li>\n<li>D65 (normalized with <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>Y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">Y=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.68333em;\"></span><span class=\"strut bottom\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span></span></span></span>) should transform to <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>L</mi><mo>=</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>a</mi><mo>=</mo><mn>0</mn><mo separator=\"true\">,</mo><mi>b</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">L=1, a=0, b=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">L</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mpunct\">,</span><span class=\"mord mathit\">a</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span><span class=\"mpunct\">,</span><span class=\"mord mathit\">b</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">0</span></span></span></span> and</li>\n<li>The <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">a</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">b</span></span></span></span> plane is scaled so that around 50% gray the ratio of color differences along the lightness axis and the <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">a</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.69444em;\"></span><span class=\"strut bottom\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\">b</span></span></span></span> plane is the same as the ratio for color differences predicted by CIEDE2000.</li>\n</ul>\n<p>Using these constraints a fairly good model was found, but based on the results two more changes was made. The <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05556em;\">γ</span></span></span></span> value ended up very close to 1/3, 0.323, and when looking at the sRGB gamut, the blue colors folded in on themselves slightly, resulting in a non-convex sRGB gamut. By forcing the value of <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.43056em;\"></span><span class=\"strut bottom\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05556em;\">γ</span></span></span></span> to 1/3 and adding a constraint the blue colors to not fold inwards, the final Oklab model was derived. The error was not noticeably affected by these restrictions.</p>\n<h3 id=\"comparison-with-other-color-spaces\">Comparison with other color spaces <a class=\"anchor-link\" href=\"#comparison-with-other-color-spaces\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p>Here are the errors for the three different datasets across color spaces, given both as root mean square error and as the 95th percentile. The best performing result is highlighted in <em>bold</em> in each row (ignoring CAM16 since it is the origin of the test data). Since the lightness and chroma data was generated using CAM16 rather than being data from experiments, this data can’t be used to say which model best matches human perception. What can be said is that Oklab does a good job at predicting hue and its predictions for chroma and lightness are close to those of CAM16-UCS.</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Oklab</th>\n<th>CIELAB</th>\n<th>CIELUV</th>\n<th>OSA-UCS</th>\n<th>IPT</th>\n<th>JzAzBz</th>\n<th>HSV</th>\n<th>CAM16-UCS</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>L RMS</td>\n<td><strong>0.20</strong></td>\n<td>1.70</td>\n<td>1.72</td>\n<td>2.05</td>\n<td>4.92</td>\n<td>2.38</td>\n<td>11.59</td>\n<td><em>0.00</em></td>\n</tr>\n<tr>\n<td>C RMS</td>\n<td><strong>0.81</strong></td>\n<td>1.84</td>\n<td>2.32</td>\n<td>1.28</td>\n<td>2.18</td>\n<td>1.79</td>\n<td>3.38</td>\n<td><em>0.00</em></td>\n</tr>\n<tr>\n<td>H RMS</td>\n<td>0.49</td>\n<td>0.69</td>\n<td>0.68</td>\n<td>0.49</td>\n<td>0.48</td>\n<td><strong>0.43</strong></td>\n<td>1.10</td>\n<td>0.59</td>\n</tr>\n<tr>\n<td>L 95</td>\n<td><strong>0.44</strong></td>\n<td>3.16</td>\n<td>3.23</td>\n<td>4.04</td>\n<td>9.89</td>\n<td>4.55</td>\n<td>23.17</td>\n<td><em>0.00</em></td>\n</tr>\n<tr>\n<td>C 95</td>\n<td><strong>1.78</strong></td>\n<td>3.96</td>\n<td>5.03</td>\n<td>2.73</td>\n<td>4.64</td>\n<td>3.77</td>\n<td>7.51</td>\n<td><em>0.00</em></td>\n</tr>\n<tr>\n<td>H 95</td>\n<td>1.06</td>\n<td>1.56</td>\n<td>1.51</td>\n<td>1.08</td>\n<td>1.02</td>\n<td><strong>0.92</strong></td>\n<td>2.42</td>\n<td>1.31</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>To be able to include HSV in these comparisons, a Lab-like color space has been defined based on it, by interpreting HSV as a cylindrical color space and converting to a regular grid.</p>\n<p>JzAzBz has been used with white scaled so that Y=100. This matches the graphs in the original paper, but it is unclear if this is how it is intended to be used. (See <a href=\"https://github.com/nschloe/colorio/issues/41\">this colorio Github issue</a> for a discussion of the topic)</p>\n</blockquote>\n<h4 id=\"munsell-data\">Munsell data <a class=\"anchor-link\" href=\"#munsell-data\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Here is <a href=\"https://www.rit.edu/cos/colorscience/rc_munsell_renotation.php\">Munsell color chart data</a> (with V=5) plotted in the various color spaces. If a color space has a chroma prediction that matches that of the Munsell data, the rings formed by the data should appear as perfect circles. The quality of this data is a bit hard to assess, since it isn’t directly using experimental data, it is a color chart created from experimental data back in the 1940s.</p>\n<p>Oklab and CAM16-UCS seem to predict the Munsell data well, while other spaces squash the circles in the dataset in various ways, which would indicate that Oklab does a better job than most of the color spaces of predicting chroma.</p>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>Oklab</strong><br>\n<img src=\"/img/oklab/oklab_munsell.png\" alt=\"Munsell plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>CIELAB</strong><br>\n<img src=\"/img/oklab/cielab_munsell.png\" alt=\"Munsell plot\"></p>\n</div>\n</div>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>CIELUV</strong><br>\n<img src=\"/img/oklab/cieluv_munsell.png\" alt=\"Munsell plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>OSA-UCS</strong><br>\n<img src=\"/img/oklab/osa_munsell.png\" alt=\"Munsell plot\"></p>\n</div>\n</div>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>IPT</strong><br>\n<img src=\"/img/oklab/ipt_munsell.png\" alt=\"Munsell plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>JzAzBz</strong><br>\n<img src=\"/img/oklab/jzazbz_munsell.png\" alt=\"Munsell plot\"></p>\n</div>\n</div>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>HSV</strong><br>\n<img src=\"/img/oklab/hsv_munsell.png\" alt=\"Munsell plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>CAM16-UCS</strong><br>\n<img src=\"/img/oklab/cam16_munsell.png\" alt=\"Munsell plot\"></p>\n</div>\n</div>\n<h4 id=\"luo-rigg-dataset-and-full-gamut\">Luo-Rigg dataset and full gamut <a class=\"anchor-link\" href=\"#luo-rigg-dataset-and-full-gamut\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>These plots show three things, ellipses, scaled based on perception of color differences from the <a href=\"https://github.com/nschloe/colorio/tree/master/colorio/data/luo-rigg\">Luo-Rigg</a> dataset, the shape of the full visible gamut (the black line corresponds to pure single wavelength lights) and a slice of the sRGB gamut.</p>\n<p>A few interesting observations are:</p>\n<ul>\n<li>The shape of the full gamut is quite odd in CIELAB and OSA-UCS, which likely means that their predictions are quite bad for highly saturated colors</li>\n<li>Except for CAM16-UCS the ellipses are stretched out as chroma increases. CAM16 explicitly compresses chroma to better match experimental data, which makes this data look good, but makes color blending worse</li>\n</ul>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>Oklab</strong><br>\n<img src=\"/img/oklab/oklab_luo_rigg.png\" alt=\"Luo-Rigg plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>CIELAB</strong><br>\n<img src=\"/img/oklab/cielab_luo_rigg.png\" alt=\"Luo-Rigg plot\"></p>\n</div>\n</div>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>CIELUV</strong><br>\n<img src=\"/img/oklab/cieluv_luo_rigg.png\" alt=\"Luo-Rigg plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>OSA-UCS</strong><br>\n<img src=\"/img/oklab/osa_luo_rigg.png\" alt=\"Luo-Rigg plot\"></p>\n</div>\n</div>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>IPT</strong><br>\n<img src=\"/img/oklab/ipt_luo_rigg.png\" alt=\"Luo-Rigg plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>JzAzBz</strong><br>\n<img src=\"/img/oklab/jzazbz_luo_rigg.png\" alt=\"Luo-Rigg plot\"></p>\n</div>\n</div>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>HSV</strong><br>\n<em>Data missing. Plot broken since HSV does not handle colors outside sRGB gamut</em></p>\n</div>\n<div class=\"column\">\n<p><strong>CAM16-UCS</strong><br>\n<img src=\"/img/oklab/cam16_luo_rigg.png\" alt=\"Luo-Rigg plot\"></p>\n</div>\n</div>\n<h4 id=\"blending-colors\">Blending colors <a class=\"anchor-link\" href=\"#blending-colors\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h4>\n<p>Here are plots of white blended with a blue color, using the various color spaces tested. The blue color has been picked since it is the hue with the most variation between spaces. CIELAB, CIELUV and HSV all show hue shifts towards purple. CAM16 has a different issue, with the color becoming desaturated quickly, resulting in a transition that doesn’t look as even as some of the other ones.</p>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>Oklab</strong><br>\n<img src=\"/img/oklab/oklab_blend.png\" alt=\"Blend plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>CIELAB</strong><br>\n<img src=\"/img/oklab/cielab_blend.png\" alt=\"Blend plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>CIELUV</strong><br>\n<img src=\"/img/oklab/cieluv_blend.png\" alt=\"Blend plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>OSA-UCS</strong><br>\n<img src=\"/img/oklab/osa_blend.png\" alt=\"Blend plot\"></p>\n</div>\n</div>\n<div class=\"columns has-background-white-ter\">\n<div class=\"column\">\n<p><strong>IPT</strong><br>\n<img src=\"/img/oklab/ipt_blend.png\" alt=\"Blend plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>JzAzBz</strong><br>\n<img src=\"/img/oklab/jzazbz_blend.png\" alt=\"Blend plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>HSV</strong><br>\n<img src=\"/img/oklab/hsv_blend.png\" alt=\"Blend plot\"></p>\n</div>\n<div class=\"column\">\n<p><strong>CAM16-UCS</strong><br>\n<img src=\"/img/oklab/cam16_blend.png\" alt=\"Blend plot\"></p>\n</div>\n</div>\n<h2 id=\"conclusion\">Conclusion <a class=\"anchor-link\" href=\"#conclusion\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h2>\n<p>This post has introduced the Oklab color space, a perceptual color space for image processing. Oklab is able to predict perceived lightness, chroma and hue well, while being simple and well-behaved numerically and easy to adopt.</p>\n<p>In future posts I want to look into using Oklab to build a better perceptual color picker and more.</p>\n<hr>\n<blockquote>\n<p><em>Oklab and the images in this post have been made using <a href=\"https://www.python.org/\">python</a>, <a href=\"/https://jupyter.org/\">jupyter</a>, <a href=\"https://numpy.org/\">numpy</a>, <a href=\"https://www.scipy.org/\">scipy</a> <a href=\"https://matplotlib.org/\">matplotlib</a>, <a href=\"https://github.com/nschloe/colorio\">colorio</a> and <a href=\"https://github.com/colour-science/colour\">colour</a>.</em></p>\n</blockquote>\n",
      "date_published": "2020-12-23T01:00:00+01:00"
    },{
      "id": "https://bottosson.github.io/posts/colorwrong/",
      "url": "https://bottosson.github.io/posts/colorwrong/",
      "title": "How software gets color wrong",
      "content_html": "<h1 id=\"how-software-gets-color-wrong\">How software gets color wrong <a class=\"anchor-link\" href=\"#how-software-gets-color-wrong\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h1>\n<p>Most software around us today are decent at accurately displaying colors. Processing of colors is another story unfortunately, and is often done badly.</p>\n<p>To understand what the problem is, let’s start with an example of three ways of blending green and magenta:</p>\n<blockquote>\n<ul>\n<li><strong>Perceptual blend</strong> – A smooth transition using a model designed to mimic human perception of color. The blending is done so that the perceived brightness and color varies smoothly and evenly.</li>\n<li><strong>Linear blend</strong> – A model for blending color based on how light behaves physically. This type of blending can occur in many ways naturally, for example when colors are blended together by focus blur in a camera or when viewing a pattern of two colors at a distance.</li>\n<li><strong>sRGB blend</strong> – This is how colors would normally be blended in computer software, using sRGB to represent the colors. <br>\n<img src=\"/img/colorwrong/greenmagenta.png\" alt=\"Blending green and magenta\"><br>\n<em>The example only reads correctly if you have a reasonably calibrated display and trichromatic color vision.</em></li>\n</ul>\n</blockquote>\n<p>As you can see, the sRGB example looks quite different. As the colors blend they shift to be much darker and bluer. Why is the standard way for blending colors different from both human perception and the physical behavior of light?</p>\n<p>As it turns out, the reason is that the color representation used in most software is based on how CRT displays in the 1990s worked. How color processing works is just a consequence of that representation. Because of this, working with color in software is harder than it needs to be and there are many unnecessary pitfalls working with image processing.</p>\n<p>The rest of this post will cover the basics of how color perception works, how it is modelled in software and how almost all software, doing any sort of color manipulation, gets color wrong.</p>\n<p>In a series of follow up posts I will look at better ways of doing processing with color.</p>\n<h3 id=\"introduction-to-color-perception-and-color-management\">Introduction to color perception and color management <a class=\"anchor-link\" href=\"#introduction-to-color-perception-and-color-management\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p><em>Skip this section if you are familiar with things like cone responses and the CIE 1931 XYZ color space</em></p>\n<p>Color is a peculiar thing. Everyday and all around us we perceive color. It wouldn’t be odd to expect color to be simple to explain and that relating it to the world around us would be easy. Instead color perception is a complicated process that takes a spectrum of light through complex and non-linear transformations. Thankfully, centuries of research has produced a decent understanding of this process and models for predicting perception exist.</p>\n<p>One key result is that our eyes don’t measure the full spectrum of light. Photoreceptor cells in the eye react to certain ranges of wavelengths, roughly corresponding to what we perceive as colors red, green and blue. The cells reacting to color are called cones. The different types of cones are referred to based on what wavelengths they are sensitive to: long, medium and short or <em>LMS</em> – long corresponds to red, medium to green and short to blue.</p>\n<blockquote>\n<p><img src=\"/img/colorwrong/coneresponse.png\" alt=\"Cone responses\"><br>\n<em>Light sensitivity for L, M and S cones for different wavelengths</em></p>\n</blockquote>\n<p>A consequence of this is that many different light spectrums can result in the same perceived color, as long as the LMS response is the same. This is the basis for many everyday things: e.g. color displays produce a wide range of colors by combining red, green and blue light. Print works similarly by using cyan, magenta and yellow ink and color paint is made by mixing various pigments to achieve the desired color.</p>\n<p>This also makes it possible to describe colors mathematically, by describing it as a mix of three primary colors. A standard exists for this called the <a href=\"https://en.wikipedia.org/wiki/CIE_1931_color_space\">CIE 1931 XYZ color space</a>, which represents colors as three values: X, Y and Z</p>\n<p>Another important result about human perception is that the mapping between perceptual qualities such as hue, brightness, colorfulness, etc. is not a fundamental property of light. The only way to numerically model them is by fitting non-linear models empirically to match human perception or by simulating human biology.</p>\n<h3 id=\"representing-color-in-software\">Representing color in software <a class=\"anchor-link\" href=\"#representing-color-in-software\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p>To describe colors in software, conventions for describing colors with numerical values is needed. A specific way of mapping colors to numbers is called <em>color space</em>. Normally color spaces use three numbers to describe colors. RGB color spaces are the most common, with the three values representing red, green and blue light.</p>\n<p>To describe a typical RGB color spaces a few things are needed: a set of red, green and blue primary colors and a non linear transfer function (sometimes referred to as gamma correction function). To represent a color in a color space two steps are performed:</p>\n<blockquote>\n<ol>\n<li>The light intensities for each of the three primary colors are calculated so that the perceived color matches the desired color. If the desired color is already represented as intensities of another set primary colors (such as the standard <a href=\"https://en.wikipedia.org/wiki/CIE_1931_color_space\">CIE 1931 XYZ color space</a>), this transformation can be done with a 3x3 matrix multiplication:</li>\n</ol>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><msub><mi>R</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mi>G</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow><msub><mi>B</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><mi mathvariant=\"bold\">M</mi></mrow><mo>×</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix} R_{linear} \\\\ G_{linear} \\\\ B_{linear} \\end{pmatrix} = \\mathbf{M} \\times \\begin{pmatrix} X \\\\ Y \\\\ Z \\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.05002em;\"></span><span class=\"strut bottom\" style=\"height:3.60004em;vertical-align:-1.55002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.00773em;\">R</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.00773em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">i</span><span class=\"mord mathit\">n</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\">G</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">i</span><span class=\"mord mathit\">n</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.05017em;\">B</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.05017em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">i</span><span class=\"mord mathit\">n</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathbf\">M</span></span><span class=\"mbin\">×</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07847em;\">X</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.22222em;\">Y</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.07153em;\">Z</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<ol start=\"2\">\n<li>The calculated intensity for each primary is normalized and transformed using the non linear transfer function.</li>\n</ol>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>R</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>G</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>B</mi></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow><mo>=</mo><mrow><mo fence=\"true\">(</mo><mtable><mtr><mtd><mrow><mi>f</mi><mo>(</mo><msub><mi>R</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mrow><mi>f</mi><mo>(</mo><msub><mi>G</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mrow><mi>f</mi><mo>(</mo><msub><mi>B</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow></msub><mo>)</mo></mrow></mtd></mtr></mtable><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{pmatrix} R \\\\ G \\\\ B \\end{pmatrix} = \\begin{pmatrix} f(R_{linear}) \\\\ f(G_{linear}) \\\\ f(B_{linear}) \\end{pmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:2.05002em;\"></span><span class=\"strut bottom\" style=\"height:3.60004em;vertical-align:-1.55002em;\"></span><span class=\"base displaystyle textstyle uncramped\"><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\">G</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05017em;\">B</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"mrel\">=</span><span class=\"minner displaystyle textstyle uncramped\"><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎝</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎛</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist\"><span style=\"top:-1.2099999999999997em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.00773em;\">R</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.00773em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">i</span><span class=\"mord mathit\">n</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:-0.00999999999999951em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\">G</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:0em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">i</span><span class=\"mord mathit\">n</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:1.1900000000000006em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"mord displaystyle textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathit\" style=\"margin-right:0.05017em;\">B</span><span class=\"vlist\"><span style=\"top:0.15em;margin-right:0.05em;margin-left:-0.05017em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle cramped\"><span class=\"mord scriptstyle cramped\"><span class=\"mord mathit\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathit\">i</span><span class=\"mord mathit\">n</span><span class=\"mord mathit\">e</span><span class=\"mord mathit\">a</span><span class=\"mord mathit\" style=\"margin-right:0.02778em;\">r</span></span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span><span class=\"mclose\">)</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span><span class=\"style-wrap reset-textstyle textstyle uncramped\"><span class=\"delimsizing mult\"><span class=\"vlist\"><span style=\"top:0.9049999999999999em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎠</span></span></span><span style=\"top:-0.89502em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"delimsizinginner delim-size4\"><span>⎞</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span></span></span></span></p>\n<p>A common choice of the non linear transfer function is a power function: <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msup><mi>x</mi><mi>γ</mi></msup></mrow><annotation encoding=\"application/x-tex\">f(x) = x^\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathit\">x</span><span class=\"mclose\">)</span><span class=\"mrel\">=</span><span class=\"mord\"><span class=\"mord mathit\">x</span><span class=\"vlist\"><span style=\"top:-0.363em;margin-right:0.05em;\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span><span class=\"reset-textstyle scriptstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05556em;\">γ</span></span></span><span class=\"baseline-fix\"><span class=\"fontsize-ensurer reset-size5 size5\"><span style=\"font-size:0em;\">​</span></span>​</span></span></span></span></span></span>, with <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>γ</mi><mo>=</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>2</mn><mi mathvariant=\"normal\">.</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">\\gamma = 1/2.2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"strut\" style=\"height:0.75em;\"></span><span class=\"strut bottom\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"base textstyle uncramped\"><span class=\"mord mathit\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mrel\">=</span><span class=\"mord mathrm\">1</span><span class=\"mord mathrm\">/</span><span class=\"mord mathrm\">2</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">2</span></span></span></span>.</p>\n</blockquote>\n<p>Examples of color spaces structured like this are: sRGB, <em>Adobe RGB</em>, <em>P3</em>, <em>Rec2020</em> (although they don’t all use a power function).</p>\n<h5 id=\"color-gamut\">Color gamut <a class=\"anchor-link\" href=\"#color-gamut\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h5>\n<p>The choice of which RGB primaries to use affects what portion of visible colors can be represented, referred to as color gamut. Choosing a wider color gamut means that more colors can be represented, but it also means that more data is needed to store colors with a high precision and that normal displays might not be able to show all the colors.</p>\n<h5 id=\"non-linear-transfer-function\">Non-linear transfer function <a class=\"anchor-link\" href=\"#non-linear-transfer-function\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h5>\n<p>The reason for the non linear transfer function existing is a bit odd. Many of the commonly used color spaces today were originally designed with CRT displays in mind, or are derived from color spaces that were, and in CRT displays the relationship between voltage and brightness is non-linear. The transfer function is added to encode the colors so that they can be used directly to drive a CRT display, without additional processing.</p>\n<p>A happy accident is that the same transfer function somewhat correlates with human perception of brightness. As a result colors encoded for CRT displays can be stored with fewer bits than ones stored linearly, which makes the encoding useful even though CRT screens are rarely used today.</p>\n<h5 id=\"color-management\">Color management <a class=\"anchor-link\" href=\"#color-management\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h5>\n<p>To consistently reproduce color across devices, information about what color spaces are used needs to be encoded and color translated to the right color space for a device. This is referred to as color management.</p>\n<p>Over the last couple of decades a lot of effort has gone into color management and this now works decently. Many displays today are calibrated fairly well out of the factory and a lot of software is built to correctly convert between color spaces as needed. Images typically have embedded color space information (using <a href=\"https://en.wikipedia.org/wiki/ICC_profile\">ICC profiles</a>) which allows them to be accurately reproduced.</p>\n<p>For applications not actively managing color sRGB has become the standard. This way, as long as the device and operating system correctly manage color, even applications without any explicit color management will work consistently. The web is a great example of this. Whenever you see a color defined as <code>#DAF7A6</code>, <code>rgb(85%, 97%, 65%)</code> or <code>hsl(118, 52%, 65%)</code>, you are probably looking at a color in sRGB.</p>\n<p>While there still are things to improve, color management overall is a success story.</p>\n<h3 id=\"desirable-operations-with-color\">Desirable operations with color <a class=\"anchor-link\" href=\"#desirable-operations-with-color\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p>Before diving into how colors are processed in software today, let’s look at what types of operations with color make sense.</p>\n<p>Common use cases for doing operations involving color in software are things like: realistically rendering images, stylizing photos, digital painting, manipulating photos, picking colors in a color picker, blending transparent elements and making color gradients etc.</p>\n<p>To support that I can see three types of operations:</p>\n<ul>\n<li><strong>Matching the behavior of real light and materials.</strong> E.g. Add artificial lens blur, add a layer of fog over an image, simulate light bouncing of a material, etc.</li>\n<li><strong>Matching the human perception of color,</strong> to achieve intuitive and predictable control. E.g. Make a color more colorful, while keeping the hue and lightness constant.</li>\n<li><strong>Stylized operations</strong>, producing interesting results but not grounded in realism or human perception. E.g. Operations like cross processing photographic film.</li>\n</ul>\n<h3 id=\"color-processing-in-software-today\">Color processing in software today <a class=\"anchor-link\" href=\"#color-processing-in-software-today\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p>Given what we know about color, it would seem reasonable that process colors is done using representations designed to either mimic the real world interaction of color or human perception. Is this commonly done? Unfortunately not. Instead color spaces designed for reproducing colors are used for doing calculation with them. This is where the problems start appearing.</p>\n<p>The most common approach is to simply use sRGB. In color managed software (such as <em>Photoshop</em>), the same color spaces are typically used for doing operations as for storing colors. This means that how operations with colors behave can be different from image to image, depending on the color space. It also means that changing color space to something that behaves better is possible, but this is not something most users do and it is hard to understand.</p>\n<p>The result is that color processing, as normally implemented, neither capture how colors behave in the real world nor how humans perceive them – it is just a byproduct of how the color space has been defined! This why image processing behavior today is determined by how CRT displays used to work in the 90s.</p>\n<h5 id=\"not-all-bad\">Not all bad <a class=\"anchor-link\" href=\"#not-all-bad\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h5>\n<p>To be fair things are slightly better than this in some specialized image processing software. Over the years ad-hoc functionality has been added here and there that better match human perception or the behavior of light. I’m also sure the developers are aware of the underlying issues, but taking a large step is probably impossible for them, since they need to keep backwards compatibility.</p>\n<p>There is also one class of software that does this fairly well: Software for rendering realistic 3D images. Here the accuracy matters much more since they need to mimic the interaction of light to achieve acceptable results.</p>\n<p>Two main approaches exist: doing computation using the RGB primaries of a color space, but without the non-linear transfer function and fully simulating the spectrum of light. The spectral approach is of course the most accurate, but also more costly. The RGB approach is completely accurate for operations and has been proven to be a reasonable trade-off practically.</p>\n<p>Some studies have been made to compare rendering using linear RGB color spaces and full spectrums:</p>\n<ul>\n<li><a href=\"https://www.colour-science.org/anders-langlands/\">Render Color Spaces - Anders Langlands</a></li>\n<li><a href=\"http://dx.doi.org/10.2312/EGWR/EGWR02/117-124\">Picture Perfect RGB Rendering Using Spectral Prefiltering and Sharp Color Primaries</a></li>\n</ul>\n<h3 id=\"comparisons\">Comparisons <a class=\"anchor-link\" href=\"#comparisons\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p>Let’s look at some more examples of blending of colors, to see how these problems surface more practically. The examples use strong colors since then the differences are more pronounced. This is using the same three ways of blending colors as the first example.</p>\n<div class=\"columns\">\n<div class=\"column\">\n<p><strong>White and green</strong><br>\n<img src=\"/img/colorwrong/whitegreen.png\" alt=\"Blending white and green\"></p>\n</div>\n<div class=\"column\">\n<p><strong>White and yellow</strong><br>\n<img src=\"/img/colorwrong/whiteyellow.png\" alt=\"Blending white and yellow\"></p>\n</div>\n</div>\n<div class=\"columns\">\n<div class=\"column\">\n<p><strong>White and red</strong><br>\n<img src=\"/img/colorwrong/whitered.png\" alt=\"Blending white and red\"></p>\n</div>\n<div class=\"column\">\n<p><strong>White and blue</strong><br>\n<img src=\"/img/colorwrong/whiteblue.png\" alt=\"Blending white and blue\"></p>\n</div>\n</div>\n<div class=\"columns\">\n<div class=\"column\">\n<p><strong>White and black</strong><br>\n<img src=\"/img/colorwrong/whiteblack.png\" alt=\"Blending white and black\"></p>\n</div>\n<div class=\"column\">\n<p><strong>Blue and yellow</strong><br>\n<img src=\"/img/colorwrong/blueyellow.png\" alt=\"Blending blue and yellow\"></p>\n</div>\n</div>\n<div class=\"columns\">\n<div class=\"column\">\n<p><strong>Cyan and red</strong><br>\n<img src=\"/img/colorwrong/cyanred.png\" alt=\"Blending cyan and red\"></p>\n</div>\n<div class=\"column\">\n<p><strong>Green and magenta</strong><br>\n<img src=\"/img/colorwrong/greenmagenta.png\" alt=\"Blending green and magenta\"></p>\n</div>\n</div>\n<p>As the examples show, the differences are quite significant:</p>\n<ul>\n<li>Neither sRGB nor linear are able to blend colors with white and keep a constant perception of hue.</li>\n<li>sRGB darkens colors significantly when mixing saturated opposing colors</li>\n<li>sRGB and perceptual color spaces blend white and black similarly, while linear blending is much brighter. This is the reason sRGB sometimes is referred to being a perceptual color space, despite its other shortcomings.</li>\n</ul>\n<p>Overall sRGB does not match color perception nor the physical behavior of light, which makes it unsuitable for image processing.</p>\n<h5 id=\"what-about-hsv-and-hsl%3F\">What about HSV and HSL? <a class=\"anchor-link\" href=\"#what-about-hsv-and-hsl%3F\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h5>\n<p>For picking colors and sometimes editing images another representation is often used: <a href=\"https://en.wikipedia.org/wiki/HSL_and_HSV\">HSL</a> (hue, saturation, lightness) and <a href=\"https://en.wikipedia.org/wiki/HSL_and_HSV\">HSV</a> (hue, saturation, value). They are not actually color spaces, they are ways of remapping RGB color spaces to parameters that are easier to work with. This means they share the properties of the RGB color spaces they are based on, which also means they share their weaknesses. HSL and HSV representations of sRGB in particular are everywhere – almost all color pickers are based on this.</p>\n<p>As an example, here is one by Google, that you can find by <a href=\"https://www.google.com/search?q=color+picker\">googling “color picker”</a>:</p>\n<p><img src=\"/img/colorwrong/colorpicker.png\" alt=\"Google color picker\"></p>\n<p>This blue color is again a clear example of a hue shift in sRGB. From the top right corner the hue shift to purple as the color gets lighter to the left, despite the HSL hue value staying constant.</p>\n<p>If a perceptual model was used instead, the same color picker would look something like this:</p>\n<p><img src=\"/img/colorwrong/evencolorpicker.png\" alt=\"Uniform hue color picker\"></p>\n<h3 id=\"what-can-we-do%3F\">What can we do? <a class=\"anchor-link\" href=\"#what-can-we-do%3F\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p>The solution is simple at a high level: instead of relying on what color space a file or display uses, color operations should be done with the use case in mind, to either model human perception or the physical behavior of light.</p>\n<p>Unfortunately doing this well in practice is quite complicated, which is probably part of the the reason it isn’t done often. Getting started is easier though.</p>\n<p>One easy thing to do is to use a linear version of sRGB when doing any sort of blending, blurring, resizing or transparency blending. This can be done simply by applying the inverse of the sRGB nonlinear transform function, doing computations, then switching back. For colors in sRGB in range 0.0 to 1.0 this can be done by applying these functions component wise (provided in C-like pseudocode):</p>\n<pre><code>float f(float x)\n{\n    if (x &gt;= 0.0031308)\n        return (1.055) * x^(1.0/2.4) - 0.055\n    else\n        return 12.92 * x\n}\n\nfloat f_inv(float x)\n{\n    if (x &gt;= 0.04045)\n        return ((x + 0.055)/(1 + 0.055))^2.4\n    else \n        return x / 12.92\n}\n</code></pre>\n<p>The same thing can also be done with color management libraries where available, which also helps when dealing with more color spaces.</p>\n<p>Perceptual representations for image processing is a less explored area. There are models aimed at understanding <a href=\"https://en.wikipedia.org/wiki/Color_appearance_model\">color appearance</a> that can be used for processing as well, but doing so isn’t without issues. A common problem is that models with high accuracy, also tend to be complicated, and when using them for image processing the results can be hard to predict for a user. This post has used <a href=\"https://en.wikipedia.org/wiki/OSA-UCS\">OSA-UCS</a>, but it also has drawbacks. The largest issue is that the conversion to the representation doesn’t have a closed-form inverse. More work is needed to find a suitable perceptual representation for image processing.</p>\n<h3 id=\"conclusion\">Conclusion <a class=\"anchor-link\" href=\"#conclusion\"><span class=\"icon is-small\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" enable-background=\"new 0 0 512 512\" xml:space=\"preserve\">\n    <path d=\"M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z\"/>\n    </svg><span></a></h3>\n<p>Instead of making it as easy as possible to work with color, most software make it unnecessarily hard, by doing image processing with representations not designed for it. Approximating the physical behavior of light with linear RGB models is one easy thing to do, but more work is needed to create image representations tailored for image processing and human perception.</p>\n<p>In a series of future posts I will look more practically at how colors can be represented for image processing and how a better color picker can be designed.</p>\n<hr>\n<blockquote>\n<p><em>The images in this post have been generated using <a href=\"https://www.python.org/\">python</a>, <a href=\"/https://jupyter.org/\">jupyter</a>, <a href=\"https://numpy.org/\">numpy</a>, <a href=\"https://matplotlib.org/\">matplotlib</a>, <a href=\"https://github.com/nschloe/colorio\">colorio</a> and <a href=\"https://github.com/colour-science/colour\">colour</a>.</em><br>\n<em>The perceptual color blending has been done with <a href=\"https://en.wikipedia.org/wiki/OSA-UCS\">OSA-UCS</a></em></p>\n</blockquote>\n",
      "date_published": "2020-12-03T01:00:00+01:00"
    }
  ]
}
